<!DOCTYPE html>
<!-- saved from url=(0095)http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Sahat Yalkabov">
<meta name="description" content="Full-Stack JavaScript Developer">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Create a character voting app using React, Node.js, MongoDB and Socket.IO</title>

<!-- Google Authorship -->
<link rel="author" href="https://plus.google.com/+SahatYalkabov?rel=author">

<!-- Favicon -->
<link rel="shortcut icon" href="http://sahatyalkabov.com/favicon.png">

<!-- Styles -->
<link href="./tutorial_files/css" rel="stylesheet" type="text/css">
<link href="./tutorial_files/css(1)" rel="stylesheet" type="text/css">
<link href="./tutorial_files/css(2)" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="./tutorial_files/font-awesome.min.css">
<link rel="stylesheet" href="./tutorial_files/devicons.min.css">
<link rel="stylesheet" href="./tutorial_files/ionicons.min.css">
<link rel="stylesheet" href="./tutorial_files/main.css">
<script type="text/javascript" async="" src="./tutorial_files/linkid.js"></script><script id="facebook-jssdk" src="./tutorial_files/sdk.js"></script><script id="twitter-wjs" src="./tutorial_files/widgets.js"></script><script async="" src="./tutorial_files/analytics.js"></script><script type="application/ld+json">
{
"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Create a character voting app using React, Node.js, MongoDB and Socket.IO",
"alternativeHeadline": "In this tutorial we are going to build a character voting app (inspired by Facemash) for EVE Online - a massively multiplayer online game. You will learn how to build a REST API with <strong>Node.js</strong>, save and retrieve data from <strong>MongoDB</strong>, track online visitors in real-time using <strong>Socket.IO</strong>, build a single-page app experience using <strong>React</strong> + <strong>Flux</strong> with server-side rendering and then finally deploy it to the cloud.",
"image": "/images/bg/7.jpg",
"datePublished": "2015-07-21T00:00:00-04:00",
"description": "In this tutorial we are going to build a character voting app (inspired by Facemash) for EVE Online - a massively multiplayer online game. You will learn how to build a REST API with <strong>Node.js</strong>, save and retrieve data from <strong>MongoDB</strong>, track online visitors in real-time using <strong>Socket.IO</strong>, build a single-page app experience using <strong>React</strong> + <strong>Flux</strong> with server-side rendering and then finally deploy it to the cloud."
}
</script>
<script id="_carbonads_projs" type="text/javascript" src="./tutorial_files/C6AILKT.json"></script><script type="text/javascript" async="" src="./tutorial_files/embed.js"></script><script type="text/javascript" charset="utf-8" async="" src="./tutorial_files/button.b059c0eb61ea902a882e5c5b3c66a17a.js"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow-x:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f6f7f8;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3a5795;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #2f477a;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f8;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(https://fbstatic-a.akamaihd.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}</style><script src="./tutorial_files/alfie.f51946af45e0b561c60f768335c9eb79.js" async="" charset="UTF-8"></script></head>
<body>

<div class="navigation">
  <a href="http://sahatyalkabov.com/" class="logo" title="Site Logo">Sahat <strong>Yalkabov</strong></a>
  <ul class="menu">
    <li><a href="http://sahatyalkabov.com/projects" title="Projects">Projects</a></li>
    <li><a href="https://github.com/sahat" title="GitHub">GitHub</a></li>
  </ul>
</div>

<div class="content" role="main">
  <article class="post">
    <div class="article-image">
      <div class="post-image-image" style="background-image: url(/images/bg/7.jpg)"></div>
      <div class="post-meta">

        <h1 class="post-title">Create a character voting app using React, Node.js, MongoDB and Socket.IO</h1>
        <div class="cf post-meta-text">
          In this tutorial we are going to build a character voting app (inspired by Facemash) for EVE Online - a massively multiplayer online game. You will learn how to build a REST API with <strong>Node.js</strong>, save and retrieve data from <strong>MongoDB</strong>, track online visitors in real-time using <strong>Socket.IO</strong>, build a single-page app experience using <strong>React</strong> + <strong>Flux</strong> with server-side rendering and then finally deploy it to the cloud.
          <p>Published on <strong>July 21, 2015</strong></p>
        </div>

        <script async="" type="text/javascript" src="./tutorial_files/carbon.js" id="_carbonads_js"></script><div id="carbonads"><span><span class="carbon-wrap"><a href="http://srv.carbonads.net/ads/click/x/GTND423MCEAIK2JLF6B4YKQWCWBITKQICVYDEZ3JCEBIV5QLCVYDPK3KC6BDP237CYBI6K3EHJNCLSIZZRLCP7I35MNFV?segment=placement:sahatyalkabovcom;&amp;encredirect=http%3A%2F%2Fwww.hipchat.com%2F%3Futm_source%3Dbuy-sell-ads%26utm_medium%3Ddisplay%26utm_campaign%3Dhipchat_carbon%26utm_content%3Dteam-chat-start-chatting_en_130x100" class="carbon-img" target="_blank"><img src="./tutorial_files/23519" alt="" border="0" height="100" width="130" style="max-width:130px;"></a><a href="http://srv.carbonads.net/ads/click/x/GTND423MCEAIK2JLF6B4YKQWCWBITKQICVYDEZ3JCEBIV5QLCVYDPK3KC6BDP237CYBI6K3EHJNCLSIZZRLCP7I35MNFV?segment=placement:sahatyalkabovcom;&amp;encredirect=http%3A%2F%2Fwww.hipchat.com%2F%3Futm_source%3Dbuy-sell-ads%26utm_medium%3Ddisplay%26utm_campaign%3Dhipchat_carbon%26utm_content%3Dteam-chat-start-chatting_en_130x100" class="carbon-text" target="_blank">Chat, made for business. Video chat, file sharing &amp; IM. $0/unlimited users.</a></span><a href="http://carbonads.net/" class="carbon-poweredby" target="_blank">ads via Carbon</a><img src="./tutorial_files/1.ver" border="0" height="1" width="1" style="display: none;"></span></div>
        <p class="cf post-meta-text carbon-container hidden">
          <i class="fa fa-bullhorn"></i> Please consider disabling your ad blocker on this site.
        </p>
      </div>
    </div>

    <div class="post-reading">
      <i class="ion-clock"></i><span class="post-reading-time">105 min</span> read
    </div>

    <section class="post-content">
      <div class="top-share">
        <iframe src="./tutorial_files/github-btn.html" frameborder="0" scrolling="0" width="104px" height="20px"></iframe>
        <iframe id="twitter-widget-1" scrolling="no" frameborder="0" allowtransparency="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" title="Twitter Tweet Button" src="./tutorial_files/tweet_button.baa54ded21a982344c4ced326592f3de.en.html" style="position: static; visibility: visible; width: 61px; height: 20px;"></iframe>
        <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" class="twitter-follow-button twitter-follow-button-rendered" title="Twitter Follow Button" src="./tutorial_files/follow_button.baa54ded21a982344c4ced326592f3de.en.html" style="position: static; visibility: visible; width: 169px; height: 20px;" data-screen-name="EvNowAndForever"></iframe>
        <div class="fb-like fb_iframe_widget" data-href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true" fb-xfbml-state="rendered" fb-iframe-plugin-query="action=like&amp;app_id=535088106626462&amp;container_width=700&amp;href=http%3A%2F%2Fsahatyalkabov.com%2Fcreate-a-character-voting-app-using-react-nodejs-mongodb-and-socketio%2F&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;share=true&amp;show_faces=true"><span style="vertical-align: bottom; width: 127px; height: 20px;"><iframe name="f39ea8e22" width="1000px" height="1000px" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:like Facebook Social Plugin" src="./tutorial_files/like.html" style="border: none; visibility: visible; width: 127px; height: 20px;" class=""></iframe></span></div>
      </div>
      <h3 id="update-notice-3-february-2-2016">Update Notice 3 (February 2, 2016)</h3>

<p>Added a new section on <em>sourcemaps</em> in <a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-2-build-system">Step 2</a>.</p>

<h3 id="update-notice-2-november-12-2015">Update Notice 2 (November 12, 2015)</h3>

<p>Tutorial has been updated to use <a href="https://medium.com/@malyw/how-to-update-babel-5-x-6-x-d828c230ec53"><strong>Babel 6.0</strong></a> and <a href="https://github.com/rackt/react-router/releases/tag/v1.0.0"><strong>React Router 1.0</strong></a>. For detailed tutorial updates see <em>November 12, 2015</em> notes below.</p>

<h3 id="update-notice-1-october-19-2015">Update Notice 1 (October 19, 2015)</h3>

<p>Tutorial has been updated to use <strong>React 0.14</strong> and <strong>React Router 1.0-rc3</strong> that introduced breaking changes. For detailed tutorial updates see <em>October 19, 2015</em> notes below.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#overview">Overview</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-1-new-express-project">Step 1. New Express Project</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-2-build-system">Step 2. Build System</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-3-project-structure">Step 3. Project Structure</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-4-es6-crash-course">Step 4. ES6 Crash Course</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-5-react-crash-course">Step 5. React Crash Course</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-6-flux-architecture-crash-course">Step 6. Flux Architecture Crash Course</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-7-react-routes-client-side">Step 7. React Routes (Client-Side)</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-8-react-routes-server-side">Step 8. React Routes (Server-Side)</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-9-footer-and-navbar-components">Step 9. Footer and Navbar Components</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-10-socket-io-real-time-user-count">Step 10. Socket.IO - Real-time User Count</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-11-add-character-component">Step 11. Add Character Component</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-12-database-schema">Step 12. Database Schema</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-13-express-api-routes-1-of-2">Step 13. Express API Routes (1 of 2)</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-14-home-component">Step 14. Home Component</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-15-express-api-routes-2-of-2">Step 15. Express API Routes (2 of 2)</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-16-character-profile-component">Step 16. Character (Profile) Component</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-17-top-100-component">Step 17. Top 100 Component</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-18-stats-component">Step 18. Stats Component</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-19-deployment">Step 19. Deployment</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#step-20-additional-resources">Step 20. Additional Resources</a></li>
<li><a href="http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/#in-closing">In Closing</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>In this tutorial we are going to build a character voting app (inspired by <em>Facemash</em> and <em>Hot or Not</em>) for <a href="http://www.eveonline.com/">EVE Online</a> - a massively multiplayer online game. Be sure to play this awesome soundtrack below to get yourself in the mood for this epicly long tutorial.</p>

<iframe width="100%" height="166" scrolling="no" frameborder="no" src="./tutorial_files/saved_resource.html"></iframe>

<p>While listening to this soundtrack, imagine yourself mining asteroid belts in deep space while keeping a lookout for pirates on the radar, researching propulsion system blueprints at the station's facility, manufacturing spaceship components for capital ships, placing buy &amp; sell orders on the entirely player-driven market where supply and demand govern the game economics, hauling trade goods from a remote solar system in a massive freighter, flying blazingly fast interceptors with a microwarpdrive or powerful battleships armored to the teeth, optimizing extraction efficiency of rare  minerals from planets, or fighting large-scale battles with thousands of players from multiple alliances. That is <strong>EVE Online</strong>.</p>

<p>Each player in EVE Online has a 3D avatar representing their character. This app is designed for ranking those avatars. Anyway, your goal here is to learn about Node.js, React and Flux, not EVE Online. But I will say this: "Having an interesting tutorial project is just as important, if not more so, than the main subject of the tutorial". The only reason I built the original <a href="http://www.newedenfaces.com/">New Eden Faces</a> app is to learn <i class="devicons devicons-backbone"></i>Backbone.js and the only reason I built the <a href="https://github.com/sahat/tvshow-tracker">TV Show Tracker</a> app is so that I could learn <i class="devicons devicons-angular"></i>AngularJS. To me, either one of these projects is far more interesting than a simple todo app that everyone seems to be using these days.</p>

<p>One thing that I have learned â€” between screencasts, books and training videos, nothing is more effective than building a small project that you are passionate about to learn a new technology.</p>

<p><img src="./tutorial_files/Screenshot 2015-03-31 23.05.36.png" alt=""></p>

<ul class="list-inline text-center">
  <li><a href="https://github.com/sahat/newedenfaces-react"><i class="ion-fork-repo"></i> GitHub Source Code</a></li>
</ul>

<p>In the same spirit as my previous tutorials (<a href="http://sahatyalkabov.com/create-a-tv-show-tracker-using-angularjs-nodejs-and-mongodb/">TV Show Tracker</a> and <a href="https://hackhands.com/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/">Instagram Clone</a>), this is a step by step full-stack JavaScript tutorial where we build a complete app from the ground up.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  This is a remake of the original <a href="http://www.newedenfaces.com/">New Eden Faces</a> (2013) project, which was my first ever single-page application written in Backbone.js. It has been running in production on <a href="https://www.openshift.com/">OpenShift</a> with Node.js 0.8.x for over 2 years now.
</div>

<p>I usually make as few assumptions as possible about a particular topic, which is why my tutorials are so lengthy, but having said that, you need to have at least some prior experience with client-side JavaScript frameworks and Node.js to get the most out of this tutorial.</p>

<p>Before proceeding, you will need to download and install the following tools:</p>

<ol>
<li><i class="devicons devicons-nodejs_small"></i> <a href="https://nodejs.org/">Node.js</a></li>
<li><i class="devicons devicons-bower"></i> <a href="http://bower.io/">Bower</a></li>
<li><i class="devicons devicons-mongodb"></i> <a href="https://www.mongodb.org/downloads">MongoDB</a></li>
<li><i class="devicons devicons-gulp"></i> <a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md">gulp</a></li>
<li><i class="devicons devicons-npm"></i> <a href="https://github.com/remy/nodemon#nodemon">nodemon</a></li>
</ol>

<h2 id="step-1-new-express-project">Step 1. New Express Project</h2>

<p>Create a new directory <strong><i class="fa fa-folder-open"></i>newedenfaces</strong>. Inside, create 2 empty files <em>package.json</em> and <em>server.js</em> using your favorite text editor or using the command line:</p>

<p><img src="./tutorial_files/Screenshot 2015-03-22 04.50.51.png" alt=""></p>

<p><strong>July 22, 2015 Update:</strong> I am using the default Terminal app in Mac OS X with <a href="https://github.com/stephenway/monokai.terminal">Monokai</a> theme and <a href="https://github.com/oh-my-fish/oh-my-fish">oh-my-fish</a> framework for the <a href="http://fishshell.com/">Fish</a> shell.</p>

<p>Open <em>package.json</em> and paste the following:</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newedenfaces"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Character voting app for EVE Online"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"repository"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/sahat/newedenfaces-react"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server.js"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node server.js"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"watch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nodemon server.js"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"babel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"presets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"es2015"</span><span class="p">,</span><span class="w"> </span><span class="s2">"react"</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"alt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.17.8"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"async"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.5.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body-parser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.14.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"colors"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.1.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"compression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.6.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.13.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"history"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.13.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mongoose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.2.5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"morgan"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.6.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.14.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react-dom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.14.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react-router"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.65.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"serve-favicon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.3.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"socket.io"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.3.7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"swig"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.4.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"underscore"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.8.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"xml2js"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.4.15"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"babel-core"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.1.19"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babel-preset-es2015"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.1.18"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babel-preset-react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.1.18"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babel-register"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.3.13"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babelify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^7.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"bower"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.6.5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"browserify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^12.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.9.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-autoprefixer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-concat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.6.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-cssmin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.1.7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-if"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-less"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.0.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-plumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-sourcemaps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.6.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-streamify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-uglify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.4.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gulp-util"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.0.7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vinyl-source-stream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"watchify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.6.0"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MIT"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>October 19, 2015 Update:</strong> Updated package versions and added two new packages: <a href="https://www.npmjs.com/package/react-dom">react-dom</a> (as part of the React 0.14 changes) and <a href="https://www.npmjs.com/package/history">history</a> (as part of the React Router 1.0 changes).</p>

<p><img src="./tutorial_files/babel-logo.svg" height="50" width="120"></p>

<p><strong>November 12, 2015 Update:</strong> Added <code>babel</code> configuration presets (new in Babel 6.x). No longer uses <code>babel-node</code> command to start or watch the server, instead you can use <code>node</code> and <code>nodemon</code> commands directly. Updated existing packages, removed unused packages, added new Babel 6.x packages.</p>

<p>These are all the packages that we will be using in this project. Let's briefly go over each package.</p>

<table><thead>
<tr>
<th>Package Name</th>
<th style="text-align: center">Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="https://github.com/goatslacker/alt">alt</a></td>
<td style="text-align: center">Flux library for React.</td>
</tr>
<tr>
<td><a href="https://github.com/caolan/async">async</a></td>
<td style="text-align: center">For managing asynchronous flow.</td>
</tr>
<tr>
<td><a href="https://github.com/expressjs/body-parser">body-parser</a></td>
<td style="text-align: center">For parsing POST request data.</td>
</tr>
<tr>
<td><a href="https://github.com/marak/colors.js/">colors</a></td>
<td style="text-align: center">Pretty console output messages.</td>
</tr>
<tr>
<td><a href="https://github.com/expressjs/compression">compression</a></td>
<td style="text-align: center">Gzip compression.</td>
</tr>
<tr>
<td><a href="http://expressjs.com/">express</a></td>
<td style="text-align: center">Web framework for Node.js.</td>
</tr>
<tr>
<td><a href="https://github.com/rackt/history">history</a></td>
<td style="text-align: center">Manage session history in browsers, used by react-router.</td>
</tr>
<tr>
<td><a href="http://mongoosejs.com/">mongoose</a></td>
<td style="text-align: center">MongoDB ODM with validation and schema support.</td>
</tr>
<tr>
<td><a href="https://github.com/expressjs/morgan">morgan</a></td>
<td style="text-align: center">HTTP request logger.</td>
</tr>
<tr>
<td><a href="http://facebook.github.io/react/">react</a></td>
<td style="text-align: center">React.</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/react-dom">react-dom</a></td>
<td style="text-align: center">React rendering, it is no longer bundled with React.</td>
</tr>
<tr>
<td><a href="https://github.com/rackt/react-router">react-router</a></td>
<td style="text-align: center">Routing library for React.</td>
</tr>
<tr>
<td><a href="https://github.com/request/request">request</a></td>
<td style="text-align: center">For making HTTP requests to EVE Online API.</td>
</tr>
<tr>
<td><a href="https://github.com/expressjs/serve-favicon">serve-favicon</a></td>
<td style="text-align: center">For serving <em>favicon.png</em> icon.</td>
</tr>
<tr>
<td><a href="http://socket.io/">socket.io</a></td>
<td style="text-align: center">To display how many users are online in real-time.</td>
</tr>
<tr>
<td><a href="http://paularmstrong.github.io/swig/">swig</a></td>
<td style="text-align: center">To render the initial HTML template.</td>
</tr>
<tr>
<td><a href="http://underscorejs.org/">underscore</a></td>
<td style="text-align: center">Helper JavaScript utilities.</td>
</tr>
<tr>
<td><a href="https://github.com/Leonidas-from-XIV/node-xml2js">xml2js</a></td>
<td style="text-align: center">For parsing XML response from EVE Online API.</td>
</tr>
</tbody></table>

<p>Run <code>npm install</code> in the Terminal to install the packages that we specified in the <em>package.json</em>.</p>

<p><img src="./tutorial_files/Screenshot 2015-03-22 05.19.19.png" alt=""></p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  If you are using Windows check out <a href="http://cmder.net/">cmder</a>
  console emulator. It is the closest thing to Mac OS X/Linux Terminal experience.
</div>

<p>Open <em>server.js</em> and paste the following code. It's a very minimal Express application, just enough to get us started.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'morgan'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'port'</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">(</span><span class="s1">'dev'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'public'</span><span class="p">)));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Express server listening on port '</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
 Although we will be building the React app in ES6, I have decided to use ES5 here because this back-end code is mostly unchanged from when I built the original <a href="https://github.com/sahat/newedenfaces">New Eden Faces</a> app. Furthermore, if you are using ES6 for the first time, it won't be too overwhelming, since the Express app should still be familiar to you.
</div>

<p>Next, create a new directory <strong><i class="fa fa-folder-open"></i>public</strong>. This is where we are going to place <em>images</em>, <em>fonts</em>, compiled <em>CSS</em> and <em>JavaScript</em> files.</p>

<p><img src="./tutorial_files/Screenshot 2015-03-22 05.41.53.png" alt=""></p>

<p>Run <code>npm start</code> in the Terminal to make sure our Express app is working without any issues.</p>

<p>You should see <strong>Express server listening on port 3000</strong> message in the Terminal.</p>

<h2 id="step-2-build-system">Step 2. Build System</h2>

<p>If you have been around in the web community at all, then you may have heard about <a href="http://browserify.org/">Browserify</a> and <a href="http://webpack.github.io/">Webpack</a> tools. If not, then consider what it would be like having to manually include all these <code>&lt;script&gt;</code> tags in a specific order, because one file may depend on another file which depends on another file.</p>

<p><img src="./tutorial_files/Screenshot 2015-06-20 22.56.37.png" alt=""></p>

<p>Additionally, we cannot use ECMAScript 6 directly in the browsers yet. Our code needs to be transformed by Babel into ECMAScript 5 before it can be served and interpreted by the browsers.</p>

<p>We will be using <a href="http://gulpjs.com/">Gulp</a> and <a href="http://browserify.org/">Browserify</a> in this tutorial instead of Webpack. I will not advocate for which tool is better or worse, but personally I found that Gulp + Browserify is more straightforward to me than an equivalent Webpack config file. I have yet to find a React boilerplate project with an easy to understand <em>webpack.config.js</em> file.</p>

<p>Create a new file <em>gulpfile.js</em> and paste the following code:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gutil</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-util'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gulpif</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-if'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">streamify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-streamify'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">autoprefixer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-autoprefixer'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cssmin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-cssmin'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">less</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-less'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">concat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-concat'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">plumber</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-plumber'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'vinyl-source-stream'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">babelify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'babelify'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">browserify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'browserify'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">watchify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'watchify'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uglify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-uglify'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sourcemaps</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-sourcemaps'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">production</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">'production'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'alt'</span><span class="p">,</span>
  <span class="s1">'react'</span><span class="p">,</span>
  <span class="s1">'react-dom'</span><span class="p">,</span>
  <span class="s1">'react-router'</span><span class="p">,</span>
  <span class="s1">'underscore'</span>
<span class="p">];</span>

<span class="cm">/*
 |--------------------------------------------------------------------------
 | Combine all JS libraries into a single file for fewer HTTP requests.
 |--------------------------------------------------------------------------
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'vendor'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span>
    <span class="s1">'bower_components/jquery/dist/jquery.js'</span><span class="p">,</span>
    <span class="s1">'bower_components/bootstrap/dist/js/bootstrap.js'</span><span class="p">,</span>
    <span class="s1">'bower_components/magnific-popup/dist/jquery.magnific-popup.js'</span><span class="p">,</span>
    <span class="s1">'bower_components/toastr/toastr.js'</span>
  <span class="p">]).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">concat</span><span class="p">(</span><span class="s1">'vendor.js'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulpif</span><span class="p">(</span><span class="nx">production</span><span class="p">,</span> <span class="nx">uglify</span><span class="p">({</span> <span class="na">mangle</span><span class="p">:</span> <span class="kc">false</span> <span class="p">})))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'public/js'</span><span class="p">));</span>
<span class="p">});</span>

<span class="cm">/*
 |--------------------------------------------------------------------------
 | Compile third-party dependencies separately for faster performance.
 |--------------------------------------------------------------------------
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'browserify-vendor'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">browserify</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="nx">dependencies</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">bundle</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">source</span><span class="p">(</span><span class="s1">'vendor.bundle.js'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulpif</span><span class="p">(</span><span class="nx">production</span><span class="p">,</span> <span class="nx">streamify</span><span class="p">(</span><span class="nx">uglify</span><span class="p">({</span> <span class="na">mangle</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}))))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'public/js'</span><span class="p">));</span>
<span class="p">});</span>

<span class="cm">/*
 |--------------------------------------------------------------------------
 | Compile only project files, excluding all third-party dependencies.
 |--------------------------------------------------------------------------
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'browserify'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'browserify-vendor'</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">browserify</span><span class="p">({</span> <span class="na">entries</span><span class="p">:</span> <span class="s1">'app/main.js'</span><span class="p">,</span> <span class="na">debug</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">external</span><span class="p">(</span><span class="nx">dependencies</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">babelify</span><span class="p">,</span> <span class="p">{</span> <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="s1">'es2015'</span><span class="p">,</span> <span class="s1">'react'</span><span class="p">]</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">streamify</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="na">loadMaps</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})))</span>
    <span class="p">.</span><span class="nx">bundle</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">source</span><span class="p">(</span><span class="s1">'bundle.js'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulpif</span><span class="p">(</span><span class="nx">production</span><span class="p">,</span> <span class="nx">streamify</span><span class="p">(</span><span class="nx">uglify</span><span class="p">({</span> <span class="na">mangle</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}))))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">streamify</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'public/js'</span><span class="p">));</span>
<span class="p">});</span>

<span class="cm">/*
 |--------------------------------------------------------------------------
 | Same as browserify task, but will also watch for changes and re-compile.
 |--------------------------------------------------------------------------
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'browserify-watch'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'browserify-vendor'</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">bundler</span> <span class="o">=</span> <span class="nx">watchify</span><span class="p">(</span><span class="nx">browserify</span><span class="p">({</span> <span class="na">entries</span><span class="p">:</span> <span class="s1">'app/main.js'</span><span class="p">,</span> <span class="na">debug</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="nx">watchify</span><span class="p">.</span><span class="nx">args</span><span class="p">));</span>
  <span class="nx">bundler</span><span class="p">.</span><span class="nx">external</span><span class="p">(</span><span class="nx">dependencies</span><span class="p">);</span>
  <span class="nx">bundler</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">babelify</span><span class="p">,</span> <span class="p">{</span> <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="s1">'es2015'</span><span class="p">,</span> <span class="s1">'react'</span><span class="p">]</span> <span class="p">})</span>
  <span class="nx">bundler</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'update'</span><span class="p">,</span> <span class="nx">rebundle</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">rebundle</span><span class="p">();</span>

  <span class="kd">function</span> <span class="nx">rebundle</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">bundler</span><span class="p">.</span><span class="nx">bundle</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">gutil</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gutil</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">red</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">()));</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">gutil</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gutil</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">green</span><span class="p">(</span><span class="s1">'Finished rebundling in'</span><span class="p">,</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'ms.'</span><span class="p">));</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">source</span><span class="p">(</span><span class="s1">'bundle.js'</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">streamify</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="na">loadMaps</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})))</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">streamify</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)))</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'public/js/'</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="cm">/*
 |--------------------------------------------------------------------------
 | Compile LESS stylesheets.
 |--------------------------------------------------------------------------
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'styles'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">'app/stylesheets/main.less'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">plumber</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">less</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">autoprefixer</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulpif</span><span class="p">(</span><span class="nx">production</span><span class="p">,</span> <span class="nx">cssmin</span><span class="p">()))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'public/css'</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'watch'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">'app/stylesheets/**/*.less'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'styles'</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'default'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'styles'</span><span class="p">,</span> <span class="s1">'vendor'</span><span class="p">,</span> <span class="s1">'browserify-watch'</span><span class="p">,</span> <span class="s1">'watch'</span><span class="p">]);</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'build'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'styles'</span><span class="p">,</span> <span class="s1">'vendor'</span><span class="p">,</span> <span class="s1">'browserify'</span><span class="p">]);</span>
</code></pre></div>
<p><strong>February 2, 2016 Update:</strong> Added <a href="https://www.npmjs.com/package/gulp-sourcemaps">gulp-sourcemaps</a> plugin.</p>

<p><strong>November 12, 2015 Update:</strong> Updated <code>babelify</code> transform to use <a href="http://babeljs.io/docs/plugins/preset-es2015/"><strong>es2015</strong></a> and <a href="http://babeljs.io/docs/plugins/preset-react/"><strong>react</strong></a> presets.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
   If you have not used Gulp before, this is a great starting point â€” <a href="http://www.sitepoint.com/introduction-gulp-js/">An Introduction to Gulp.js</a>.
</div>

<p>Although the code should be more or less self-explanatory with those task names and code comments, let's briefly go over each task for completeness.</p>

<table><thead>
<tr>
<th>Gulp Task</th>
<th style="text-align: center">Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>vendor</code></td>
<td style="text-align: center">Concatenates all JS libraries into one file.</td>
</tr>
<tr>
<td><code>browserify-vendor</code></td>
<td style="text-align: center">For performance reasons, NPM modules specified in the <code>dependencies</code> array are compiled and bundled separately. As a result, <em>bundle.js</em> recompiles a few hundred milliseconds faster.</td>
</tr>
<tr>
<td><code>browserify</code></td>
<td style="text-align: center">Compiles and bundles just the app files, without any external modules like <em>react</em> and <em>react-router</em>.</td>
</tr>
<tr>
<td><code>browserify-watch</code></td>
<td style="text-align: center">Essentially the same task as above but it will also listen for changes and re-compile <em>bundle.js</em>.</td>
</tr>
<tr>
<td><code>styles</code></td>
<td style="text-align: center">Compiles LESS stylesheets and automatically adds browser prefixes if necessary.</td>
</tr>
<tr>
<td><code>watch</code></td>
<td style="text-align: center">Re-compiles LESS stylesheets on file changes.</td>
</tr>
<tr>
<td><code>default</code></td>
<td style="text-align: center">Runs all of the above tasks and starts watching for file changes.</td>
</tr>
<tr>
<td><code>build</code></td>
<td style="text-align: center">Runs all of the above tasks then exits.</td>
</tr>
</tbody></table>

<h4 id="sourcemaps"><i class="fa fa-map"></i> Sourcemaps</h4>

<p>What are sourcemaps? Why do we need them? Sourcemaps, as the name implies, map a concatenated/minified file back to an original state (source file). We have two tasks above â€” <code>browserify</code> and <code>browserify-watch</code> that will generate a single file called <code>bundle.js</code>. This file is not meant to be human-readable, but rather interpreted by the browsers. So what happens when an error is thrown and you are trying to debug the problem? Consider the following example:</p>

<p><img src="./tutorial_files/Screenshot 2016-02-02 22.27.05.png" alt=""></p>

<p>Notice that an error has occurred on a <em>line 2088</em> that does not match any of our source files. Clicking on it, reveals some details about the problem. In this particular case, you can easily figure out where it happened, especially if the code is not minified/mangled. <em>Not shown here, but if I were to scroll up a little, there is a function called <strong>Stats</strong>, which would immediately tell you that the problem is in the <strong>Stats</strong> component.</em></p>

<p><img src="./tutorial_files/Screenshot 2016-02-02 22.27.22.png" alt=""></p>

<p>But it is a completely different story when you are working on a large React application, consisting of hundreds of components, written by many different people, spanning thousands and thousands lines of code.</p>

<p>After adding sourcemaps support in the <em>gulpfile.js</em> above, here is how it would look like in the same scenario. First, a new file with a <code>*.js.map</code> extension is generated. </p>

<p><img src="./tutorial_files/Screenshot 2016-02-02 22.35.18.png" alt=""></p>

<p>Next, both Google Chrome and Mozilla Firefox will automatically try to load CSS and JavaScript sourcemaps, when available.</p>

<p><img src="./tutorial_files/Screenshot 2016-02-02 22.34.01.png" alt=""></p>

<p>That's much better! It tells you not only in which file an error was thrown, but the exact line number as well. Clicking on the error above shows us the original source code.</p>

<p><img src="./tutorial_files/Screenshot 2016-02-02 22.34.13.png" alt=""></p>

<p><strong>Note:</strong> You may want to modify Gulp tasks above so that sourcemaps are generated only in <em>development mode</em>, similar to how code is minified code via <a href="https://www.npmjs.com/package/gulp-uglify">gulp-uglify</a> only in <em>production mode</em>.</p>

<p>Next, we will shift focus to the project structure by creating files and folders that <em>gulpfile.js</em> is expecting.</p>

<h2 id="step-3-project-structure">Step 3. Project Structure</h2>

<p>In the <strong><i class="fa fa-folder-open"></i>public</strong> directory create 4 new folders <strong><i class="fa fa-folder-open"></i>css</strong>, <strong><i class="fa fa-folder-open"></i>js</strong>, <strong><i class="fa fa-folder-open"></i>fonts</strong> and <strong><i class="fa fa-folder-open"></i>img</strong>. Also, download this <a href="https://raw.githubusercontent.com/sahat/newedenfaces-react/master/public/favicon.png">favicon.png</a> and place it here as well.</p>

<p><img src="./tutorial_files/Screenshot 2015-06-21 00.47.32.png" alt=""></p>

<p>It will show that an error is thrown on some line that does not exist in any of your source files. Clicking on the error, will reveal the details of where it has occurred.</p>

<p><img src="./tutorial_files/Screenshot 2016-02-02 22.27.22.png" alt=""></p>

<p>In the <strong><i class="fa fa-folder-open"></i>newedenfaces</strong> directory (project root), create a new folder <strong><i class="fa fa-folder-open"></i>app</strong>.</p>

<p>Then inside <strong><i class="fa fa-folder-open"></i>app</strong> create 4 new folders <strong><i class="fa fa-folder-open"></i>actions</strong>, <strong><i class="fa fa-folder-open"></i>components</strong>, <strong><i class="fa fa-folder-open"></i>stores</strong>, <strong><i class="fa fa-folder-open"></i>stylesheets</strong> and 3 empty files <em>alt.js</em>, <em>routes.js</em> and <em>main.js</em>.</p>

<p><img src="./tutorial_files/Screenshot 2015-06-21 00.58.43.png" alt=""></p>

<p>In the <strong><i class="fa fa-folder-open"></i>stylesheets</strong> directory create a new file <em>main.less</em> which we will populate with CSS styles shortly.</p>

<p>Back in the project root directory (<strong><i class="fa fa-folder-open"></i>newedenfaces</strong>), create a new file <em>bower.json</em> and paste the following:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newedenfaces"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"jquery"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.4"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"bootstrap"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.3.5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"magnific-popup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"toastr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
Bower is a package manager that lets you easily download JavaScript libraries, such as the ones specified above, via a command line instead of visiting each individual website, downloading, extracting and adding it to the project manually.
</div>

<p>Run <code>bower install</code> and wait for the packages to be downloaded and installed into the <strong><i class="fa fa-folder-open"></i>bower_components</strong> directory. You can change that path using the <a href="http://bower.io/docs/config/#directory"><em>.bowerrc</em></a> file, but for the purposes of this tutorial we will stick with the defaults.</p>

<p>Similarly to <strong><i class="fa fa-folder-open"></i>node_modules</strong>, you should not commit <strong><i class="fa fa-folder-open"></i>bower_components</strong> into a Git repository. But hold on, if we don't commit it to Git, how will those files be loaded when you deploy your app? We will revisit this issue later during the deployment step of this tutorial.</p>

<p>Copy all glyphicons fonts from <strong><i class="fa fa-folder-open"></i>bower_components/bootstrap/fonts</strong> into <strong><i class="fa fa-folder-open"></i>public/fonts</strong> directory.</p>

<p>Download and extract the following background images and place them into <strong><i class="fa fa-folder-open"></i>public/img</strong> directory:</p>

<ul>
<li><a href="http://sahatyalkabov.com/assets/Background%20Images.zip">Background Images.zip</a></li>
</ul>

<div class="admonition note">
  <div class="admonition-title">Fun Fact</div>
 I have used the Gaussian blur in Adobe Photoshop in order to create that out of focus effect over 3 years ago when I built the original New Eden Faces project, but now it should be totally possible to achieve a similar effect using <a href="http://codepen.io/aniketpant/pen/DsEve">CSS filters</a>.
</div>

<p>Open <em>main.less</em> that we just created and paste the following styles from the link below. Due to the sheer length of it, I have decided to include it as a separate file.</p>

<ul>
<li><a href="https://github.com/sahat/newedenfaces-react/blob/master/app/stylesheets/main.less"><i class="devicons devicons-css3"></i> main.less</a></li>
</ul>

<p>If you have used the <a href="http://getbootstrap.com/">Bootstrap</a> CSS framework in the past, then most of it should be already familiar to you.</p>

<p>I don't know if you are aware of the latest <a href="https://speakerdeck.com/vjeux/react-css-in-js">trend</a> to include styles directly inside React components, but I am not sure if I like this new practice. Perhaps when tooling gets better I will revisit this topic, until then I will use external stylesheets like I always have been. However, if you are interested in using modular CSS, check out <a href="https://github.com/css-modules/css-modulesify">css-modulesify</a>.</p>

<p><strong>October 19, 2015 Update:</strong> If you are building reusable React components like <a href="http://elemental-ui.com/">Elemental UI</a> and <a href="http://material-ui.com/">Material UI</a> then by all means do it. Personally, I would actually prefer if I don't have to import accompanying "vendor" stylesheets, as we do with just much every user-interface jQuery library.</p>

<p>Before we jump into building the React app, I have decided to dedicate the next three sections to ES6, React, Flux, otherwise it may be too overwhelming trying to learn everything at once. Personally, I had a very hard time following some React + Flux code examples written in ES6 because I was learning a new syntax, a new framework and a completely unfamiliar app architecture all at once.</p>

<p>Since I cannot cover everything in-depth, we will be going over only those topics that you need to know for this tutorial.</p>

<h2 id="step-4-es6-crash-course">Step 4. ES6 Crash Course</h2>

<p>The best way to learn ES6 is by showing an equivalent ES5 code for every ES6 example. Again, I will only be covering what you need to know for this tutorial. There are plenty of blog posts that go in great detail about the new ES6 features.</p>

<p><strong><i class="ion-archive"></i>Modules (Import)</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES6</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">,</span> <span class="nx">DefaultRoute</span><span class="p">,</span> <span class="nx">NotFoundRoute</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES5</span>
<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-router'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Route</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">.</span><span class="nx">Route</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">DefaultRoute</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">.</span><span class="nx">DefaultRoute</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">NotFoundRoute</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">.</span><span class="nx">NotFoundRoute</span><span class="p">;</span>
</code></pre></div>
<p>Using the ES6 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destructuring assignment</a> we can import a subset of a module which can be quite useful for modules like <em>react-router</em> and <em>underscore</em> where it exports more than one function.</p>

<p>One thing to keep in mind is that ES6 imports are hoisted. All dependent modules will be loaded before any of the module code is executed. In other words, you can't conditionally load a module like with CommonJS. That did throw me off a little when I tried to import a module inside an if-else condition.</p>

<p>For a detailed overview of the <code>import</code> statement see this <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">MDN page</a>.</p>

<p><strong><i class="ion-share"></i>Modules (Export)</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES6</span>
<span class="kd">function</span> <span class="nx">Add</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Add</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES5</span>
<span class="kd">function</span> <span class="nx">Add</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Add</span><span class="p">;</span>
</code></pre></div>
<p>To learn more about ES6 modules, as well as different ways of importing and exporting functions from a module, check out <a href="http://www.2ality.com/2014/09/es6-modules-final.html">ECMAScript 6 modules</a> and <a href="http://www.sitepoint.com/understanding-es6-modules/">Understanding ES6 Modules</a>.</p>

<p><strong><i class="ion-cube"></i>Classes</strong></p>

<p>ES6 classes are nothing more than a syntactic sugar over the existing prototype-based inheritance in JavaScript. As long as you remember that fact, the <code>class</code> keyword will not seem like a foreign concept to you.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES6</span>
<span class="kr">class</span> <span class="nx">Box</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">length</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">length</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">calculateArea</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">box</span><span class="p">.</span><span class="nx">calculateArea</span><span class="p">();</span> <span class="c1">// 4</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES5</span>
<span class="kd">function</span> <span class="nx">Box</span><span class="p">(</span><span class="nx">length</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">length</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Box</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">calculateArea</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">box</span><span class="p">.</span><span class="nx">calculateArea</span><span class="p">();</span> <span class="c1">// 4</span>
</code></pre></div>
<p>With ES6 classes you can now use <code>extends</code> to create a subclass from an existing class:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES6</span>
<span class="kr">class</span> <span class="nx">MyComponent</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// Now MyComponent contains all React component methods</span>
  <span class="c1">// such as componentDidMount(), render() and etc.</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES5</span>
<span class="kd">var</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="c1">// Now MyComponent contains all React component methods</span>
  <span class="c1">// such as componentDidMount(), render() and etc.</span>
<span class="p">})</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> Added the ES5 example using <code>React.createClass</code>.</p>

<p>For more information about ES6 classes visit <a href="http://www.2ality.com/2015/02/es6-classes-final.html">Classes in ECMAScript 6</a> blog post.</p>

<p><strong><i class="ion-social-javascript"></i><code>var</code> vs <code>let</code></strong></p>

<p>The only difference between the two is that <code>var</code> is scoped to the nearest <em>function block</em> and <code>let</code> is scoped to the nearest <em>enclosing block</em>  - which could be a <em>function</em>, a <em>for-loop</em> or an <em>if-statement block</em>.</p>

<p>Here is a good <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let">example</a> showing the difference between <code>var</code> and <code>let</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// The scope is inside the if-block</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// The scope is inside the function</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>  <span class="c1">// 4</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>  <span class="c1">// 1</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span> <span class="c1">// 5</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span> <span class="c1">// 1</span>
</code></pre></div>
<p>Basically, <code>let</code> is block scoped, <code>var</code> is function scoped.</p>

<p><strong><i class="ion-android-send"></i>Arrow Functions (Fat Arrow)</strong></p>

<p>An arrow function expression has a shorter syntax compared to function expressions and lexically binds the <code>this</code> value.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ES6</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// [2, 4, 6]</span>

<span class="c1">// ES5</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// [2, 4, 6]</span>
</code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
Parentheses around the single argument are optional, so it is up to you whether you want to enforce it or not. Some see it as a bad practice, others think it's fine.
</div>

<p>Besides a shorter syntax, what else is it useful for?</p>

<p>Consider the following example, straight from this project before I converted it to ES6.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters'</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span> <span class="na">gender</span><span class="p">:</span> <span class="nx">gender</span> <span class="p">}</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">helpBlock</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">helpBlock</span><span class="p">:</span> <span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="na">gender</span><span class="p">:</span> <span class="s1">''</span> <span class="p">});</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</code></pre></div>
<p>Every function expression above creates its own <code>this</code> scope. Without binding <code>this</code> we would not be able to call <code>this.setState</code> in the example above, because <code>this</code> would have been <em>undefined</em>.</p>

<p>Alternatively, we could have assigned <code>this</code> to a variable, e.g. <code>var self = this</code> and then used <code>self.setState</code> instead of <code>this.setState</code> inside the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures">closures</a> to get around this classic JavaScript problem.</p>

<p>In any case, here is an equivalent ES6 code using fat arrow functions which preserve the original <code>this</code> value:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters'</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span> <span class="na">gender</span><span class="p">:</span> <span class="nx">gender</span> <span class="p">}</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">helpBlock</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">helpBlock</span><span class="p">:</span> <span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">always</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="na">gender</span><span class="p">:</span> <span class="s1">''</span> <span class="p">});</span>
  <span class="p">});</span>
</code></pre></div>
<p>Next, let's talk about React, what makes it so special and why should we use it.</p>

<h2 id="step-5-react-crash-course">Step 5. React Crash Course</h2>

<p><i class="devicons devicons-react"></i> React is a JavaScript library for building web user interfaces. You could say it competes against <i class="devicons devicons-angular"></i> AngularJS, <i class="devicons devicons-ember"></i> Ember.js, <i class="devicons devicons-backbone"></i> Backbone and <i class="devicons devicons-webplatform"></i> Polymer despite being much smaller in scope. React is just the <strong>V</strong> in the <strong>MVC</strong> (Model-View-Controller) architecture.</p>

<p>So, what is so special about React?</p>

<p>React components are written in a very declarative style. Unlike the "old way" using jQuery and such, you don't interact with DOM directly. React manages all UI updates when the underlying data changes.</p>

<p>React is also very fast thanks to the Virtual DOM and diffing algorithm under the hood. When the data changes, React calculates the minimum number of DOM manipulations needed, then efficiently re-renders the component. For example, if there are 10,000 rendered items on a page and only 1 item changes, React will update just that DOM element, leaving 9,999 other items unchanged. That's why React can get away with re-rendering the entire components without being ridiculously wasteful and slow.</p>

<p>Other notable features of React include:</p>

<ul>
<li><strong>Composability</strong>, i.e. make bigger, more complex components out of smaller components.</li>
<li><strong>Relatively easy to pick up</strong> since there isn't that much to learn and it does not have a massive documentation like AngularJS and Ember.js.</li>
<li><strong>Server-side rendering</strong> allows us to easily build <a href="https://medium.com/@mjackson/universal-javascript-4761051b7ae9">Isomorphic JavaScript apps</a>.</li>
<li>The most <strong>helpful error and warning messages</strong> that I have seen in any JavaScript library.</li>
<li><strong>Components are self-contained</strong>; markup and behavior (<a href="http://blog.vjeux.com/2014/javascript/react-css-in-js-nationjs.html">and even styles</a>) live in the same place, making components very reusable.</li>
</ul>

<p><strong>October 19, 2015 Update:</strong> We will not be building a true Isomorphic JavaScript app. If you disable JavaScript your Browser, a page will be rendered just fine for the most part, but it will not render any characters because that requires more work by fetching data from the database and then passing it to the root React component that will need to pass the data down to its children components, which is outside the scope of this tutorial. </p>

<p>I really like this excerpt from the <a href="http://facebook.github.io/react/blog/2015/07/03/react-v0.14-beta-1.html">React v0.14 Beta 1 blog post</a> announcement that sums up nicely what React is all about:</p>

<blockquote>
<p>It's become clear that the beauty and essence of React has nothing to do with browsers or the DOM. We think the true foundations of React are simply ideas of components and elements: being able to describe what you want to render in a declarative way.</p>
</blockquote>

<hr>

<p>Before going any further please watch this awesome video <a href="https://egghead.io/lessons/react-react-in-7-minutes">React in 7 Minutes</a> by John Lindquist.</p>

<p>And while you are there, I highly recommend getting the <strong>PRO</strong> subscription ($24.99/month) to unlock over 94 React and <a href="https://facebook.github.io/react-native/">React Native</a> video lessons. No, you will not become an expert just by watching these videos, but they are amazing at giving you short and straight to the point explanations on any particular topic. If you are on a budget, you can subscribe for 1 month, download all the videos, then cancel your subscription at the end of the month. Subscribing not only gives you access to React lessons, but also to <a href="https://egghead.io/technologies/typescript">TypeScript</a>, <a href="https://egghead.io/technologies/angular2">Angular 2</a>, <a href="https://egghead.io/technologies/d3">D3</a>, <a href="https://egghead.io/technologies/es6">ECMAScript 6</a>, <a href="https://egghead.io/technologies/node">Node.js</a> and more.</p>

<p><strong><i class="fa fa-hand-o-right"></i> Disclaimer:</strong> I am not affiliated with <em>Egghead.io</em> and I do not get any commissions for referrals. </p>

<p>While learning React, the biggest challenge for me was that it required a completely different thinking approach to building UIs. Which is why reading <a href="https://facebook.github.io/react/docs/thinking-in-react.html">Thinking in React</a> guide is absolutely a must for anyone who is starting out with React.</p>

<p>In similar fashion to the <em>Product Table</em> from <a href="https://facebook.github.io/react/docs/thinking-in-react.html">Thinking in React</a>, if we are to break apart the <em>New Eden Faces</em> UI into potential components, this is what it would look like:</p>

<p><img src="./tutorial_files/Screen Shot 2015-06-21 at 11.45.38 PM copy.png" alt=""></p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  Each component should try to adhere to the <em>single responsibility principle</em>. If you find yourself working on a component that does too many things, perhaps it's best to split it into sub-components. Having said that, I typically write monolithic components first, just to get it working, then refactor it by splitting it into smaller sub-components.
</div>

<p>The top-level <span style="color: #FF4136">App</span> component contains <span style="color: #0074D9">Navbar</span>, <span style="color: #0074D9">Homepage</span> and <span style="color: #0074D9">Footer</span> components. <span style="color: #0074D9">Homepage</span> component contains two <span style="color: #2ECC40">Character</span> components.</p>

<p>So, whenever you have a certain UI design in mind, start by breaking it apart from top-down and always be mindful of how your data propagates from parent to child, child to parent and between sibling components or you will quickly find yourself completely lost. It may be difficult initially, but it will become second nature to you after building a few React apps.</p>

<p>So, next time you decide to build a new app in React, before writing any code, do this hierarchy outline first. It will help you to visualize the relationships between multiple components and build them accordingly.</p>

<hr>

<p>All components in React have a <code>render()</code> method. It always returns a <em>single child</em> element. Conversly, the following return statement is invalid because it contains 3 child elements:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Invalid JSX</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Achura</span><span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Civire</span><span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Deteis</span><span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The HTML markup above is actually called <a href="https://facebook.github.io/react/docs/jsx-in-depth.html">JSX</a>. As far syntax goes, it is just slightly different from HTML, for example <code>className</code> instead of <code>class</code> to define CSS classes. You will learn more about it as we start building the app.</p>

<p>When I first saw that syntax, I was immediately repulsed by it. I am used to returning booleans, numbers, strings, objects and functions in JavaScript, but certaintly not that. However, JSX is actually just a syntactic sugar. After fixing the code above by wrapping it with a <code>&lt;ul&gt;</code> tag (must return a single element), here is what it looks like without JSX:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Achura'</span><span class="p">),</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Civire'</span><span class="p">),</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'li'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Deteis'</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>I think you will agree that JSX is far more readable than plain JavaScript. Furthermore, <a href="http://babeljs.io/">Babel</a> has a built-in support for JSX, so we don't need to install anything extra. If you have ever worked with AngularJS directives then you will appreciate working with React components, so instead of having two different files â€” <em>directive.js</em> (logic) and <em>template.html</em> (presentation), you have a single file containing both logic and presentation.</p>

<p>The <a href="https://facebook.github.io/react/docs/component-specs.html#mounting-componentdidmount"><code>componentDidMount</code></a> method in React is the closest thing to <a href="https://learn.jquery.com/using-jquery-core/document-ready/"><code>$(document).ready</code></a> in jQuery. This method runs once (<a href="https://facebook.github.io/react/docs/component-specs.html#mounting-componentdidmount">only on the client</a>) immediately after initial rendering of the component. This is where you would typically initialize third-party libraries and jQuery plugins, or connect to Socket.IO.</p>

<p>You will be using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">Ternary operator</a> in the <a href="https://facebook.github.io/react/docs/component-specs.html#render"><code>render</code></a> method quite a lot: hiding an element when data is empty, conditionally using CSS classes depending on some value, hiding or showing certain elements based on the component's state and etc.</p>

<p>Consider the following example that conditionally sets the CSS class to <span style="color: #FF4136">text-danger</span> or <span style="color: #2ECC40">text-success</span> based on the props value.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">delta</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">delta</span> <span class="p">?</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">strong</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">delta</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="s1">'text-success'</span> <span class="p">:</span> <span class="s1">'text-danger'</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">delta</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/strong</span><span class="err">&gt;
</span>  <span class="p">)</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'card'</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">delta</span><span class="p">}</span>
      <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>We have only scratched the surface of everything there is to React, but this should be enough to give you a general idea about React as well as its benefits.</p>

<p>React on its own is actually really simple and easy to grasp. However, it is when we start talking about <a href="https://facebook.github.io/flux/">Flux</a> architecture, things can get a little confusing.</p>

<h2 id="step-6-flux-architecture-crash-course">Step 6. Flux Architecture Crash Course</h2>

<p>Flux is the application architecture that was developed at Facebook for building scalable client-side web applications.
 It complements React's components by utilizing a unidirectional data flow. Flux is more of a pattern than a framework, however, we will be using a Flux library called <a href="http://alt.js.org/">Alt</a> to minimize writing the boilerplate code.</p>

<p>Have you seen this diagram before? Did it make any sense to you? It did not make any sense to me, no matter how many times I looked at it.</p>

<p><img src="./tutorial_files/flux-diagram.png" alt=""></p>

<p>Now that I understand it better, I am actually really amazed by how such simple architecture can be presented in a such complicated way. But to Facebook's credit, their <a href="https://facebook.github.io/flux/docs/overview.html#structure-and-data-flow">new Flux diagrams</a> are much better than before.</p>

<div class="admonition note">
  <div class="admonition-title">Fun Fact</div>
 When I first began writing this tutorial I decided not to use Flux in this project. I could not grasp it for the life of me, let alone teach it to others. But thankfully, I get to work on cool stuff at Yahoo where I get to play and experiment with different technologies during my work hours. Honestly, we could have built this app without Flux and it would have been less lines of code. We don't have here any complex or nested components. But I believe that showing a full-stack React app with server-side rendering and Flux architecture, to see how all pieces connect together, has a value in of itself.
</div>

<p>Instead of reiterating the <a href="https://facebook.github.io/flux/docs/overview.html">Flux  Overview</a>, let's take a look at one of the real-world use cases in order to illustrate how Flux works:</p>

<p><img src="./tutorial_files/Screenshot 2015-06-22 02.18.48.png" alt=""></p>

<ol>
<li><p>On <code>componentDidMount</code> (when the page is rendered) three actions are fired:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">OverviewActions</span><span class="p">.</span><span class="nx">getSummary</span><span class="p">();</span>
<span class="nx">OverviewActions</span><span class="p">.</span><span class="nx">getApps</span><span class="p">();</span>
<span class="nx">OverviewActions</span><span class="p">.</span><span class="nx">getCompanies</span><span class="p">();</span>
</code></pre></div></li>
<li><p>Each one of those actions makes an AJAX request to the server to fetch the data.</p></li>
<li><p>When the data is fetched, each action fires another <em>"success"</em> action and passes the data along with it:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">getSummary</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">request</span>
    <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/overview/summary'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">end</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getSummarySuccess</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>Meanwhile, the <em>Overview</em> store (a place where we keep the state for <em>Overview</em> component) is listening for those <em>"success"</em> actions. When the <code>getSummarySuccess</code> action is fired, <code>onGetSummarySuccess</code> method in the <em>Overview</em> store is called and the store is updated:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">OverviewStore</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">OverviewActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">summary</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">apps</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">companies</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>

  <span class="nx">onGetSummarySuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">summary</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetAppsSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">apps</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetCompaniesSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">companies</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>As soon as the store is updated, the <em>Overview</em> component will know about it because it has subscribed to the <em>Overview</em> store. When a store is updated/changed, a component will set its own state to whatever is in that store.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Overview</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">OverviewStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">OverviewStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">OverviewStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>At this point the <em>Overview</em> component has been updated with the new data.</p></li>
<li><p>In screenshot above,when the date range is updated from the dropdown menu, the entire process is repeated all over again.</p></li>
</ol>

<div class="admonition note">
  <div class="admonition-title">Note</div>
 Action names do not matter, use whatever naming convention you want as long as it is descriptive and makes sense.
</div>

<p>Ignoring the <em>Dispatcher</em> for a moment, can you see the one-way flow outlined above? If not, it's alright, it will start making more sense as we start building the app.</p>

<p><img src="./tutorial_files/flux-simple-f8-diagram-1300w.png" alt=""></p>

<p><strong>Flux Summary</strong></p>

<p>Flux is really just a fancy term for <strong>pub/sub</strong> architecture, i.e. data always flows one way through the application and it is picked up along the way by various subscribers (stores) who are listening to it.</p>

<hr>

<p>There are more than a dozen of Flux implementations at the time of this writing. Out of them all, I only have experience with <a href="https://github.com/spoike/refluxjs">RefluxJS</a> and <a href="http://alt.js.org/">Alt</a>. Between the two, I personally prefer Alt for its simplicity, great support by <a href="https://github.com/goatslacker"><em>@goatslacker</em></a>, server-side rendering support, great documentation and the project is actively maintained.</p>

<p>I strongly encourage you to go through the Alt's <a href="http://alt.js.org/guide/">Getting Started</a> guide. It will take no more than 10 minutes to skim through it.</p>

<p>If you are undecided on the Flux library, consider the following <a href="https://news.ycombinator.com/item?id=9833099">comment</a> by <em>glenjamin</em> on Hacker News, in response to having a hard time figuring out which Flux library to use:</p>

<blockquote>
<p>The dirty secret is: they're probably all fine.
It's unlikely that you will choose a flux lib that will be the make or break point of your application.
Even if a library stops being "maintained", most decent flux incarnations are really small (~100 LoC) - it's unlikely that there's some fatal flaw you'll be stuck with.
In summary: redux is neat, but don't beat yourself up over choosing the perfect flux lib - just grab one that you like the look of and move on with building your application.</p>
</blockquote>

<hr>

<p>Now that we have covered some basics behind ES6, React and Flux, it is time to move on to building the application.</p>

<h2 id="step-7-react-routes-client-side">Step 7. React Routes (Client-Side)</h2>

<p>Create a new file <em>App.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> with the following contents:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div>
<p><del><code>RouteHandler</code> is a component that</del> <code>{this.props.children}</code> now renders the active child route handler. It will render one of the following components depending on the URL path: <em>Home</em>, <em>Top 100</em>, <em>Profile</em> or <em>Add Character</em>.</p>

<p><strong>October 19, 2015 Update:</strong> <a href="https://github.com/rackt/react-router/blob/master/UPGRADE_GUIDE.md#routehandler">RouteHandler is gone</a>. Router now automatically populates <code>this.props.children</code> of your components based on the active route.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
It is similar to <a href="https://docs.angularjs.org/api/ngRoute/directive/ngView"><code>&lt;div ng-view&gt;&lt;/div&gt;</code></a> in AngularJS, which includes the rendered template of current route into the main layout.
</div>

<p>Next, open <em>routes.js</em> inside <strong><i class="fa fa-folder-open"></i>app</strong> and paste the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">'./components/Home'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Home</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> The <code>handler</code> prop is now called <code>component</code>. Named routes are gone as well.</p>

<p>The reason for nesting routes this particular way is because we are going to place <em>Navbar</em> and <em>Footer</em> components, above and below the active route, inside the <em>App</em> component. Unlike other components, <em>Navbar</em> and <em>Footer</em> do not change/disappear between route transitions. (See outlined screenshot from <strong>Step 5</strong>)</p>

<p>Lastly, we need to add a URL listener and render the application when it changes. Open <em>main.js</em> inside the <strong><i class="fa fa-folder-open"></i>app</strong> directory that we created earlier and paste the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Router</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">createBrowserHistory</span> <span class="nx">from</span> <span class="s1">'history/lib/createBrowserHistory'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">routes</span> <span class="nx">from</span> <span class="s1">'./routes'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">createBrowserHistory</span><span class="p">();</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Router</span> <span class="nx">history</span><span class="o">=</span><span class="p">{</span><span class="nx">history</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">routes</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/Router&gt;, document.getElementById</span><span class="se">(</span><span class="sr">'app'</span><span class="se">))</span><span class="err">;
</span></code></pre></div>
<p><strong>October 19, 2015 Update:</strong> <code>React.render</code> now lives in the <a href="https://www.npmjs.com/package/react-dom">react-dom</a> package. <code>Router.HistoryLocation</code> is now handled by the <a href="https://github.com/rackt/history">history</a> package. We use <em>history</em> to enable HTML5 History API and to programmatically transition between routes. Routes are now passed in to the <code>&lt;Router&gt;</code> component as children instead of prop.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
The <em>main.js</em> is the entry point for our React application. We use it in <em>gulpfile.js</em> where Browserify will traverse the entire tree of dependencies and generate the final <em>bundle.js</em> file. You will rarely have to touch this file after its initial setup.
</div>

<p><a href="http://rackt.github.io/react-router/">React Router</a> bootstraps the routes from <em>routes.js</em> file, matches them against a URL, and then executes the appropriate callback handler, which in this case means rendering a React component into <code>&lt;div id="app"&gt;&lt;/div&gt;</code>. But how does it know which component to render? Well, for example, if we are on <code>/</code> URL path, then <code>{this.props.children}</code> will render the <em>Home</em> component, because that's what we have specified in <em>routes.js</em>. We will add more routes shortly.</p>

<p>Also, notice that we are using <a href="https://github.com/rackt/history"><code>createBrowserHistory</code></a> to enable HTML5 History API in order to make URLs look pretty. For example, it navigates to <code>http://localhost:3000/add</code> instead of  <code>http://localhost:3000/#add</code>. Since we are building an Isomorphic React application (rendered on the server and the client) we do not have to do any hacky <a href="https://github.com/sahat/tvshow-tracker/blob/master/server.js#L343-L345">wildcard redirects on the server</a> to enable this support. It just works out of the box.</p>

<p>Let's create one last React component for this section. Create a new file <em>Home.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> with the following contents:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Home</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'alert alert-info'</span><span class="o">&gt;</span>
        <span class="nx">Hello</span> <span class="nx">from</span> <span class="nx">Home</span> <span class="nx">Component</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Home</span><span class="p">;</span>
</code></pre></div>
<p>Below should be everything we have created up to this point. This would be a good time to double check your code.</p>

<p><img src="./tutorial_files/Screenshot 2015-10-20 01.03.41.png" alt=""></p>

<p>One last thing, open <em>alt.js</em> in the <strong><i class="fa fa-folder-open"></i>app</strong> directory and paste the following code. I will explain its purpose in <strong>Step 9</strong> when we actually get to use it.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Alt</span> <span class="nx">from</span> <span class="s1">'alt'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Alt</span><span class="p">();</span>
</code></pre></div>
<p>Now we just need to set up a few more things on the back-end and then we can finally run the app.</p>

<h2 id="step-8-react-routes-server-side">Step 8. React Routes (Server-Side)</h2>

<p>Open <em>server.js</em> and import the following modules by adding them at the top of the file:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Babel ES6/JSX Compiler</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">'babel-register'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">swig</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'swig'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ReactDOM</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-dom/server'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-router'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./app/routes'</span><span class="p">);</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> Previous <code>React.renderToString</code> now lives in the <a href="https://www.npmjs.com/package/react-dom#on-the-server"><code>react-dom/server</code></a> package.</p>

<p><strong>November 12, 2015 Update:</strong> Added Babel <a href="https://babeljs.io/docs/setup/#babel_register">Require Hook</a>. All subsequent files required by Node with the extensions <code>.es6</code>, <code>.es</code>, <code>.jsx</code> and <code>.js</code> will be transformed by Babel. Since I have switched to <em>Require Hook</em>, it is no longer necessary to run the app using <code>babel-node</code> command as mentioned in <strong>Step 1</strong>. Furthermore, this <em>Require Hook</em> will use Babel presets we specified in <em>package.json</em>.  To learn more about <em>Require Hook</em> usage and configuration, check out Babel <a href="https://babeljs.io/docs/usage/require/">documentation guide</a>.</p>

<p><strong>December 22, 2015 Update:</strong> Use <code>require('babel-register')</code> instead of <code>require('babel-core/register')</code> in accordance to Babel <a href="https://babeljs.io/docs/setup/#babel_register">docs</a>.</p>

<p>Next, add the following <a href="http://expressjs.com/guide/using-middleware.html">middleware</a> to <em>server.js</em>, somewhere after existing Express middlewares:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Router</span><span class="p">.</span><span class="nx">match</span><span class="p">({</span> <span class="na">routes</span><span class="p">:</span> <span class="nx">routes</span><span class="p">.</span><span class="k">default</span><span class="p">,</span> <span class="na">location</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">redirectLocation</span><span class="p">,</span> <span class="nx">renderProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">redirectLocation</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">302</span><span class="p">).</span><span class="nx">redirect</span><span class="p">(</span><span class="nx">redirectLocation</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">+</span> <span class="nx">redirectLocation</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">renderProps</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span><span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">Router</span><span class="p">.</span><span class="nx">RoutingContext</span><span class="p">,</span> <span class="nx">renderProps</span><span class="p">));</span>
      <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">swig</span><span class="p">.</span><span class="nx">renderFile</span><span class="p">(</span><span class="s1">'views/index.html'</span><span class="p">,</span> <span class="p">{</span> <span class="na">html</span><span class="p">:</span> <span class="nx">html</span> <span class="p">});</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s1">'Page Not Found'</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> Previous <code>React.renderToString</code> now lives in the <a href="https://www.npmjs.com/package/react-dom#on-the-server"><code>react-dom/server</code></a> package. Additionally, server-side rendering with React Router has changed quite a bit. See <a href="https://github.com/rackt/react-router/blob/f81c8e46883e7838e2790fba14c10a4822e5163a/docs/guides/advanced/ServerRendering.md#server-rendering">Server Rendering Guide</a> for more details.</p>

<p><strong>November 12, 2015 Update:</strong> <code>&lt;RoutingContext {...renderProps} /&gt;</code> (ES6/JSX) has been replaced with <code>React.createElement(Router.RoutingContext, renderProps)</code> (ES5). That's because Babel <em>Require Hook</em> transforms only subsequent files, not current file. In other words, using JSX here will result in an illegal syntax error. Of course there are ways around this limitation, but I wanted to avoid creating additional files.</p>

<blockquote>
<p><strong>Note:</strong> This screenshot is now outdated as of React 0.14 and React Router 1.0 but I left it here anyway to give you a better idea of where to place this middleware in <em>server.js</em>.</p>
</blockquote>

<p><img src="./tutorial_files/Screenshot 2015-06-22 22.01.53.png" alt=""></p>

<p>This middleware function will be executed on every request to the server, unless a request is handled by one the API endpoints that we will implement shortly.</p>

<p>Conditional statements within the <code>Router.match</code> should be self-explanatory. Depending on if we have <em>500 Error</em>, <em>302 Redirect</em>, <em>200 Success</em>, <em>404 Not Found</em>, we take different actions. The last two â€” <em>200 Success</em> and <em>404 Not Found</em> are usually the most common responses.</p>

<p>On the client-side, a rendered HTML markup gets inserted into <code>&lt;div id="app"&gt;&lt;/div&gt;</code>, while on the server a rendered HTML markup is sent to the <em>index.html</em> template where it is inserted into <code>&lt;div id="app"&gt;{{ html|safe }}&lt;/div&gt;</code> by the <a href="http://paularmstrong.github.io/swig/">Swig</a> template engine. <em>I chose Swig because I wanted to try something other than <a href="http://jade-lang.com/">Jade</a> and <a href="http://handlebarsjs.com/">Handlebars</a> this time</em>.</p>

<p>But do we really need a separate template for this? Why not just render everything inside the <em>App</em> component? Yes, you could do it, as long as you are okay with <a href="https://validator.w3.org/">invalid HTML markup</a> and not being able to include inline script tags like Google Analytics directly in the <em>App</em> component. But having said that, invalid markup is probably not relevant to SEO anymore and there are <a href="https://github.com/hzdg/react-google-analytics/blob/master/src/index.coffee">workarounds</a> to include inline script tags in React components. So it's up to you, but for the purposes of this tutorial we will be using a Swig template.</p>

<p>One last thing I need to explain are those JavaScript tripple dots. It is called the ES6 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator">spread operator</a> used in <code>{...renderProps}</code> above. That's basically like saying "just pass me everything". Since <code>renderProps</code> contains multiple things - <em>routes</em>, <em>params</em>, <em>components</em>, <em>location</em>, <em>history</em>, it would be a hassle to pass them as individual props. Spread operator is a handy shortcut for situations like these.</p>

<p><strong>October 19, 2015 Update:</strong> Added a new paragraph about the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator">spread operator</a> and new Router matching conditions.</p>

<p><strong>November 12, 2015 Update:</strong> Spread operator is no longer used, however, previous paragraph is still relevant and useful, since you will no doubt run into this <code>...</code> notation again when developing React apps.</p>

<p><img src="./tutorial_files/Screenshot 2015-10-20 01.47.04.png" alt=""></p>

<p>Create a new folder <strong><i class="fa fa-folder-open"></i>views</strong> in the project root directory  (next to <em>package.json</em> and <em>server.js</em>). Then inside <strong><i class="fa fa-folder-open"></i>views</strong>, create a new file <em>index.html</em>:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;title&gt;</span>New Eden Faces<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,900"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"/css/main.css"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"app"</span><span class="nt">&gt;</span>{{ html|safe }}<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/vendor.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/vendor.bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>Open two Terminal tabs. In one tab run <code>gulp</code> to build the app, concatenate vendor files, compile LESS stylesheets and watch for file changes:
<img src="./tutorial_files/Screenshot 2015-06-22 22.47.05.png" alt=""></p>

<p>In another tab, run <code>npm run watch</code> to start the Node.js server and automatically restart the process on file changes:</p>

<p><img src="./tutorial_files/Screenshot 2015-06-22 22.50.23.png" alt=""></p>

<p><strong>July 27, 2015 Update:</strong> Once again, make sure you have installed <a href="https://github.com/remy/nodemon">nodemon</a> via <code>sudo npm install -g nodemon</code> otherwise you will not be able to run the command above.</p>

<p>Open <a href="http://localhost:3000/">http://localhost:3000</a> and you should see our React app render successfully:</p>

<p><img src="./tutorial_files/Screenshot 2015-06-22 22.53.01.png" alt=""></p>

<p>We did an impressive amount of work just to display an empty page with a simple alert message! Fortunately, the most difficult part is behind us. From here on we can relax and focus on building React components and implementing the REST API endpoints.</p>

<p>Both <code>gulp</code> and <code>npm run watch</code> processes will take care of everything for us. We no longer need to worry about re-compiling the app after adding new React components or restarting the Express app after making changes to <em>server.js</em>.</p>

<h2 id="step-9-footer-and-navbar-components">Step 9. Footer and Navbar Components</h2>

<p>Both <em>Navbar</em> and <em>Footer</em> are relatively simple components. The <em>Footer</em> component fetches and displays the Top 5 characters. The <em>Navbar</em> component fetches and displays the total character count and initializes a Socket.IO event listener for tracking the number of online visitors.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  This section will be slightly longer than the rest since I will be covering  a lot of new concepts that other sections are built upon.
</div>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>Footer.js</em> inside <strong><i class="fa fa-folder-open"></i>components</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Link</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">FooterStore</span> <span class="nx">from</span> <span class="s1">'../stores/FooterStore'</span>
<span class="kr">import</span> <span class="nx">FooterActions</span> <span class="nx">from</span> <span class="s1">'../actions/FooterActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Footer</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">FooterStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">FooterStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">FooterActions</span><span class="p">.</span><span class="nx">getTopCharacters</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">FooterStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">leaderboardCharacters</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characters</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">character</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'thumb-md'</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'http://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_128.jpg'</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>      <span class="p">)</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">footer</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'row'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-sm-5'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">h3</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Information</span><span class="o">&lt;</span><span class="sr">/strong&gt; and &lt;strong&gt;Copyright&lt;/</span><span class="nx">strong</span><span class="o">&gt;&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Powered</span> <span class="nx">by</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Node</span><span class="p">.</span><span class="nx">js</span><span class="o">&lt;</span><span class="sr">/strong&gt;, &lt;strong&gt;MongoDB&lt;/</span><span class="nx">strong</span><span class="o">&gt;</span> <span class="nx">and</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">React</span><span class="o">&lt;</span><span class="sr">/strong&gt; with Flux architecture and server-side rendering.&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">may</span> <span class="nx">view</span> <span class="nx">the</span> <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s1">'https://github.com/sahat/newedenfaces-react'</span><span class="o">&gt;</span><span class="nx">Source</span> <span class="nx">Code</span><span class="o">&lt;</span><span class="sr">/a&gt; behind this project on GitHub.&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="err">Â©</span> <span class="mi">2015</span> <span class="nx">Sahat</span> <span class="nx">Yalkabov</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-sm-7 hidden-xs'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">h3</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Leaderboard</span><span class="o">&lt;</span><span class="sr">/strong&gt; Top 5 Characters&lt;/</span><span class="nx">h3</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-inline'</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="nx">leaderboardCharacters</span><span class="p">}</span>
              <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/footer</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Footer</span><span class="p">;</span>
</code></pre></div>
<p>Just this once, I will show an ES5-equivalent code for this component in case you are still not comfortable with the new ES6 syntax. Also, see <a href="http://alt.js.org/guides/es5/">Using Alt with ES5</a> guide for syntax differences when creating actions and creating stores.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Link</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-router'</span><span class="p">).</span><span class="nx">Link</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">FooterStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../stores/FooterStore'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">FooterActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../actions/FooterActions'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Footer</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">FooterStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nl">componentDidMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">FooterStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">FooterActions</span><span class="p">.</span><span class="nx">getTopCharacters</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nl">componentWillUnmount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">FooterStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nl">onChange</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">leaderboardCharacters</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characters</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'thumb-md'</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'http://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_128.jpg'</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">footer</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'row'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-sm-5'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">h3</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Information</span><span class="o">&lt;</span><span class="sr">/strong&gt; and &lt;strong&gt;Copyright&lt;/</span><span class="nx">strong</span><span class="o">&gt;&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Powered</span> <span class="nx">by</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Node</span><span class="p">.</span><span class="nx">js</span><span class="o">&lt;</span><span class="sr">/strong&gt;, &lt;strong&gt;MongoDB&lt;/</span><span class="nx">strong</span><span class="o">&gt;</span> <span class="nx">and</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">React</span><span class="o">&lt;</span><span class="sr">/strong&gt; with Flux architecture and server-side rendering.&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">may</span> <span class="nx">view</span> <span class="nx">the</span> <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s1">'https://github.com/sahat/newedenfaces-react'</span><span class="o">&gt;</span><span class="nx">Source</span> <span class="nx">Code</span><span class="o">&lt;</span><span class="sr">/a&gt; behind this project on GitHub.&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="err">Â©</span> <span class="mi">2015</span> <span class="nx">Sahat</span> <span class="nx">Yalkabov</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-sm-7 hidden-xs'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">h3</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Leaderboard</span><span class="o">&lt;</span><span class="sr">/strong&gt; Top 5 Characters&lt;/</span><span class="nx">h3</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-inline'</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="nx">leaderboardCharacters</span><span class="p">}</span>
              <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/footer</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Footer</span><span class="p">;</span>
</code></pre></div>
<p>If you can recall the previous section on Flux architecture, then this should all be familiar to you. When component is loaded it sets the initial component state to whatever is in the <em>FooterStore</em> and initialzes a store listener, likewise when component is unloaded (e.g. navigated to a different page) that store listener is removed. When the store is updated, <code>onChange</code> function is called, which in turn updates the <em>Footer's</em> state.</p>

<p>If by any chance you have used React before, there is something you need to keep in mind when creating React components using ES6 classes. Component methods no longer autobind <code>this</code> context. For example, when calling an internal component method that uses <code>this</code>, you need to bind <code>this</code> explicitly. Previously, <code>React.createClass()</code> was doing it for us internally:</p>

<blockquote>
<p><strong>Autobinding</strong>: When creating callbacks in JavaScript, you usually need to explicitly bind a method to its instance such that the value of <strong>this</strong> is correct. With React, every method is automatically bound to its component instance.</p>
</blockquote>

<p>That is why we have the following line in ES6, but not in ES5:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div>
<p>Here is a more complete example on this issue:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">AppStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">;</span> <span class="c1">// Need to add `.bind(this)`.</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Object `this` will be undefined without binding it explicitly.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>You may or may not be familiar with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>map()</code></a> method in JavaScript. Even if you have used it before, it may still be unclear how it works in the context of JSX. (Something that <a href="http://facebook.github.io/react/docs/tutorial.html#hook-up-the-data-model">React Tutorial</a> regretfully does not explain very well.)</p>

<p>It is basically a <em>for-each</em> loop, similar to what you might see in <a href="http://jade-lang.com/reference/iteration/">Jade</a> and <a href="http://handlebarsjs.com/builtin_helpers.html#iteration">Handlebars</a>, but here you can assign the results to a variable, which can then be used with JSX by wrapping it in curly braces. It's a very common pattern in React so you will be using it quite frequently.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  When rendering <a href="https://facebook.github.io/react/docs/multiple-components.html#dynamic-children">dynamic children</a>, such as <code>leaderboardCharacters</code> above, React requires that you use the <code>key</code> property to uniquely identify each child element.
</div>

<p>A <a href="http://rackt.github.io/react-router/#Link"><code>Link</code></a> component will render a fully accesible anchor tag with the proper <em>href</em>. It also knows when the route it links to is active and automatically applies its "active" CSS class. If you are using React Router, then you need to be using <code>Link</code> for internal navigation between routes.</p>

<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Next, we are going to create actions and a store for the <em>Footer</em>  component. Create a new file called <em>FooterActions.js</em> in <strong><i class="fa fa-folder-open"></i>app/actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">FooterActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'getTopCharactersSuccess'</span><span class="p">,</span>
      <span class="s1">'getTopCharactersFail'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getTopCharacters</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters/top'</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getTopCharactersSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getTopCharactersFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">FooterActions</span><span class="p">);</span>
</code></pre></div>
<p>First, notice that we import an instance of Alt (<em>alt.js</em> from <strong>Step 7</strong>), not the Alt module installed in <strong><i class="fa fa-folder-open"></i>node_modules</strong>. It is an instance of Alt which instantiates <a href="http://facebook.github.io/flux/docs/dispatcher.html#content">Flux dispatcher</a> and provides methods for creating Alt actions and stores. You can think of it as a glue between all of our stores and actions.</p>

<p>We have three actions here - the one that fetches the data using <a href="http://api.jquery.com/jquery.ajax/"><code>jQuery.ajax()</code></a> and two that notify the store whether that action was successful or unsuccessful. In this particular case, it is not very useful to know when <code>getTopCharacters</code> action is fired. What we really want to know is if that action was successful (<em>update the store, then re-render the component with new data</em>) or unsuccessful (<em>display an error notification</em>).</p>

<p>Actions can be as complex or as simple as you need them to be. Some actions are "actions" themselves, where we don't care what they do or what they send, the fact that action was fired is all we need to know. For example, <code>ajaxInProgress</code> and <code>ajaxComplete</code> to notify a store when AJAX request is in progress or complete.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  Alt actions can be created via a shorthand notation using <code>generateActions</code> method. From the documentation on <a href="http://alt.js.org/docs/createActions/">Creating Actions</a> â€” <em>If all of your actions are just straight through dispatches you can shorthand generate them using this function.</em>
</div>

<p>The two shorthand actions above created via <code>generateActions</code> and the following two simple actions are equivalent, so use either notation based on your preference:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">getTopCharactersSuccess</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">getTopCharactersFail</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Equivalent to this...</span>
<span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
  <span class="s1">'getTopCharactersSuccess'</span><span class="p">,</span>
  <span class="s1">'getTopCharactersFail'</span>
<span class="p">);</span>
</code></pre></div>
<p>And lastly, we wrap the <em>FooterActions</em> class with <a href="http://alt.js.org/docs/createActions/#createActions"><code>alt.createActions</code></a> and then export it, so that we could import and use it in the <em>Footer</em> component.</p>

<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Next, create a new file called <em>FooterStore.js</em> inside <strong><i class="fa fa-folder-open"></i>app/stores</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">FooterActions</span> <span class="nx">from</span> <span class="s1">'../actions/FooterActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">FooterStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">FooterActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characters</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>

  <span class="nx">onGetTopCharactersSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characters</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onGetTopCharactersFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle multiple response formats, fallback to HTTP status code number.</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span> <span class="o">&amp;&amp;</span> <span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseText</span> <span class="o">||</span> <span class="nx">jqXhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">FooterStore</span><span class="p">);</span>
</code></pre></div>
<p>All instance variables of the store, i.e. values assigned to <code>this</code>, will become part of the state. When <em>Footer</em> component initially calls <code>FooterStore.getState()</code> it receives the current state of the store specified in the constructor (initially just an empty array, and mapping over an empty array returns another empty array, hence nothing is rendered when the <em>Footer</em> component is first loaded).</p>

<p><a href="http://alt.js.org/docs/createStore/#storemodelbindactions"><code>bindActions</code></a> is a magic Alt method which binds actions to their handlers defined in the store. For example, an action with the name <code>foo</code> will match an action handler method defined in the store named <code>onFoo</code> or just <code>foo</code> but not both. That is why for actions <code>getTopCharactersSuccess</code> and <code>getTopCharactersFail</code> defined in <em>FooterActions.js</em> we have corresponding store handlers called <code>onGetTopCharactersSuccess</code> and <code>onGetTopCharactersFail</code> in <em>FooterStore.js</em>.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  For more precise control over which actions the store listens to and what handlers those actions are bound to, see <a href="http://alt.js.org/docs/createStore/#storemodelbindlisteners"><code>bindListeners</code></a> method.
</div>

<p>I hope it's pretty clear by now that when <code>getTopCharactersSuccess</code> action is fired, <code>onGetTopCharactersSuccess</code> handler function is executed and the store is updated with the new data that contains <em>Top 5 Characters</em>. And since we have initialized the store listener in the <em>Footer</em> component, it will be notified when the <em>FooterStore</em> has been updated and the component will re-render accordingly.</p>

<p>We will be using <a href="http://codeseven.github.io/toastr/demo.html">Toastr</a> JavaScript library for notifications. Why not just use pure React notification component you may ask? While you may find some notification components built specifically for React, I personally think it is one of the few areas that should not be handled by React (<em>along with tooltips</em>). I think it is far easier to display a notification imperatively from any part of your application than having to declaratively render notification component based on the current state. I have built a notification component with React and Flux before, but frankly it was a big pain dealing with hide/show states, animation and z-index positioning.</p>

<p>Open <em>App.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> and import the <em>Footer</em> component:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Footer</span> <span class="nx">from</span> <span class="s1">'./Footer'</span><span class="p">;</span>
</code></pre></div>
<p>Then add <code>&lt;Footer /&gt;</code> right after the <code>{this.props.children}</code> line:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div&gt;</span>
  {this.props.children}
  <span class="nt">&lt;Footer</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Refresh the browser and you should see the new footer.</p>

<p><img src="./tutorial_files/Screenshot 2015-06-30 12.45.26.png" alt=""></p>

<p>We will implement Express API endpoints and populate the database with characters shortly, but for now let's continue on to the <em>Navbar</em> component. Since I have already covered the basics behind Alt actions and stores, and how they fit in with our app architecture, this will be a shorter sub-section.</p>

<hr>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>Navbar.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Link</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">NavbarStore</span> <span class="nx">from</span> <span class="s1">'../stores/NavbarStore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">NavbarActions</span> <span class="nx">from</span> <span class="s1">'../actions/NavbarActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Navbar</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">NavbarStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">NavbarStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">NavbarActions</span><span class="p">.</span><span class="nx">getCharacterCount</span><span class="p">();</span>

    <span class="kd">let</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'onlineUsers'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">NavbarActions</span><span class="p">.</span><span class="nx">updateOnlineUsers</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxStart</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">NavbarActions</span><span class="p">.</span><span class="nx">updateAjaxAnimation</span><span class="p">(</span><span class="s1">'fadeIn'</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxComplete</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">NavbarActions</span><span class="p">.</span><span class="nx">updateAjaxAnimation</span><span class="p">(</span><span class="s1">'fadeOut'</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">750</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">NavbarStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="kd">let</span> <span class="nx">searchQuery</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">searchQuery</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">searchQuery</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">NavbarActions</span><span class="p">.</span><span class="nx">findCharacter</span><span class="p">({</span>
        <span class="na">searchQuery</span><span class="p">:</span> <span class="nx">searchQuery</span><span class="p">,</span>
        <span class="na">searchForm</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">searchForm</span><span class="p">,</span>
        <span class="na">history</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">history</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">nav</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'navbar navbar-default navbar-static-top'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'navbar-header'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'button'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'navbar-toggle collapsed'</span> <span class="nx">data</span><span class="o">-</span><span class="nx">toggle</span><span class="o">=</span><span class="s1">'collapse'</span> <span class="nx">data</span><span class="o">-</span><span class="nx">target</span><span class="o">=</span><span class="s1">'#navbar'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'sr-only'</span><span class="o">&gt;</span><span class="nx">Toggle</span> <span class="nx">navigation</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'icon-bar'</span><span class="o">&gt;&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'icon-bar'</span><span class="o">&gt;&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'icon-bar'</span><span class="o">&gt;&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'navbar-brand'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">ref</span><span class="o">=</span><span class="s1">'triangles'</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="s1">'triangles animated '</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">ajaxAnimationClass</span><span class="p">}</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri invert'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri invert'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri invert'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri invert'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri invert'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'tri invert'</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>            <span class="nx">NEF</span>
            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'badge badge-up badge-danger'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">onlineUsers</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s1">'navbar'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'navbar-collapse collapse'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">ref</span><span class="o">=</span><span class="s1">'searchForm'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'navbar-form navbar-left animated'</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'input-group'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'text'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'form-control'</span> <span class="nx">placeholder</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">totalCharacters</span> <span class="o">+</span> <span class="s1">' characters'</span><span class="p">}</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">searchQuery</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">NavbarActions</span><span class="p">.</span><span class="nx">updateSearchQuery</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'input-group-btn'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'btn btn-default'</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'glyphicon glyphicon-search'</span><span class="o">&gt;&lt;</span><span class="sr">/span&gt;&lt;/</span><span class="nx">button</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'nav navbar-nav'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/'</span><span class="o">&gt;</span><span class="nx">Home</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/stats'</span><span class="o">&gt;</span><span class="nx">Stats</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s1">'#'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-toggle'</span> <span class="nx">data</span><span class="o">-</span><span class="nx">toggle</span><span class="o">=</span><span class="s1">'dropdown'</span><span class="o">&gt;</span><span class="nx">Top</span> <span class="mi">100</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'caret'</span><span class="o">&gt;&lt;</span><span class="sr">/span&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top'</span><span class="o">&gt;</span><span class="nx">Top</span> <span class="nx">Overall</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/caldari'</span><span class="o">&gt;</span><span class="nx">Caldari</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/caldari/achura'</span><span class="o">&gt;</span><span class="nx">Achura</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/caldari/civire'</span><span class="o">&gt;</span><span class="nx">Civire</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/caldari/deteis'</span><span class="o">&gt;</span><span class="nx">Deteis</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/gallente'</span><span class="o">&gt;</span><span class="nx">Gallente</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/gallente/gallente'</span><span class="o">&gt;</span><span class="nx">Gallente</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/gallente/intaki'</span><span class="o">&gt;</span><span class="nx">Intaki</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/gallente/jin-mei'</span><span class="o">&gt;</span><span class="nx">Jin</span><span class="o">-</span><span class="nx">Mei</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/minmatar'</span><span class="o">&gt;</span><span class="nx">Minmatar</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/minmatar/brutor'</span><span class="o">&gt;</span><span class="nx">Brutor</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/minmatar/sebiestor'</span><span class="o">&gt;</span><span class="nx">Sebiestor</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/minmatar/vherokior'</span><span class="o">&gt;</span><span class="nx">Vherokior</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/amarr'</span><span class="o">&gt;</span><span class="nx">Amarr</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/amarr/amarr'</span><span class="o">&gt;</span><span class="nx">Amarr</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/amarr/ni-kunni'</span><span class="o">&gt;</span><span class="nx">Ni</span><span class="o">-</span><span class="nx">Kunni</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/top/amarr/khanid'</span><span class="o">&gt;</span><span class="nx">Khanid</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'divider'</span><span class="o">&gt;&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/shame'</span><span class="o">&gt;</span><span class="nx">Hall</span> <span class="nx">of</span> <span class="nx">Shame</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s1">'#'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-toggle'</span> <span class="nx">data</span><span class="o">-</span><span class="nx">toggle</span><span class="o">=</span><span class="s1">'dropdown'</span><span class="o">&gt;</span><span class="nx">Female</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'caret'</span><span class="o">&gt;&lt;</span><span class="sr">/span&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female'</span><span class="o">&gt;</span><span class="nx">All</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/caldari'</span><span class="o">&gt;</span><span class="nx">Caldari</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/caldari/achura'</span><span class="o">&gt;</span><span class="nx">Achura</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/caldari/civire/'</span><span class="o">&gt;</span><span class="nx">Civire</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/caldari/deteis'</span><span class="o">&gt;</span><span class="nx">Deteis</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/gallente'</span><span class="o">&gt;</span><span class="nx">Gallente</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/gallente/gallente'</span><span class="o">&gt;</span><span class="nx">Gallente</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/gallente/intaki'</span><span class="o">&gt;</span><span class="nx">Intaki</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/gallente/jin-mei'</span><span class="o">&gt;</span><span class="nx">Jin</span><span class="o">-</span><span class="nx">Mei</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/minmatar'</span><span class="o">&gt;</span><span class="nx">Minmatar</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/minmatar/brutor'</span><span class="o">&gt;</span><span class="nx">Brutor</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/minmatar/sebiestor'</span><span class="o">&gt;</span><span class="nx">Sebiestor</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/minmatar/vherokior'</span><span class="o">&gt;</span><span class="nx">Vherokior</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/amarr'</span><span class="o">&gt;</span><span class="nx">Amarr</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/amarr/amarr'</span><span class="o">&gt;</span><span class="nx">Amarr</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/amarr/ni-kunni'</span><span class="o">&gt;</span><span class="nx">Ni</span><span class="o">-</span><span class="nx">Kunni</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/female/amarr/khanid'</span><span class="o">&gt;</span><span class="nx">Khanid</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s1">'#'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-toggle'</span> <span class="nx">data</span><span class="o">-</span><span class="nx">toggle</span><span class="o">=</span><span class="s1">'dropdown'</span><span class="o">&gt;</span><span class="nx">Male</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'caret'</span><span class="o">&gt;&lt;</span><span class="sr">/span&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male'</span><span class="o">&gt;</span><span class="nx">All</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/caldari'</span><span class="o">&gt;</span><span class="nx">Caldari</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/caldari/achura'</span><span class="o">&gt;</span><span class="nx">Achura</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/caldari/civire'</span><span class="o">&gt;</span><span class="nx">Civire</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/caldari/deteis'</span><span class="o">&gt;</span><span class="nx">Deteis</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/gallente'</span><span class="o">&gt;</span><span class="nx">Gallente</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/gallente/gallente'</span><span class="o">&gt;</span><span class="nx">Gallente</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/gallente/intaki'</span><span class="o">&gt;</span><span class="nx">Intaki</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/gallente/jin-mei'</span><span class="o">&gt;</span><span class="nx">Jin</span><span class="o">-</span><span class="nx">Mei</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/minmatar'</span><span class="o">&gt;</span><span class="nx">Minmatar</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/minmatar/brutor'</span><span class="o">&gt;</span><span class="nx">Brutor</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/minmatar/sebiestor'</span><span class="o">&gt;</span><span class="nx">Sebiestor</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/minmatar/vherokior'</span><span class="o">&gt;</span><span class="nx">Vherokior</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-submenu'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/amarr'</span><span class="o">&gt;</span><span class="nx">Amarr</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'dropdown-menu'</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/amarr/amarr'</span><span class="o">&gt;</span><span class="nx">Amarr</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/amarr/ni-kunni'</span><span class="o">&gt;</span><span class="nx">Ni</span><span class="o">-</span><span class="nx">Kunni</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/male/amarr/khanid'</span><span class="o">&gt;</span><span class="nx">Khanid</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s1">'/add'</span><span class="o">&gt;</span><span class="nx">Add</span><span class="o">&lt;</span><span class="sr">/Link&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/nav</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Navbar</span><span class="p">;</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> Removed <code>Navbar.contextTypes</code> that was previously used to get an instance of the router and removed <code>getDOMNode()</code> method call since <code>this.refs.searchForm</code> already returns a DOM node now.</p>

<p>Yes it is certainly possible to write most of the above markup dynamically with less lines of code by iterating through all races, then through all bloodlines, however, this was one of those things that I copy &amp; pasted from my original project and didn't want to focus on too much.</p>

<p><del>One thing you will probably notice right away is the class variable <code>contextTypes</code>. We need it for referencing an instance of the router, which in turn gives us access to current <em>path</em>, current <em>query parameters</em>, <em>route parameters</em> and <em>transitions</em> to other routes.</del> Now the <code>history</code> object (navigation) will be passed as a prop from the <em>App</em> component. We actually do not use it directly in the <em>Navbar</em> component but instead pass it as an argument to <em>Navbar</em> actions so that it could navigate to a particular character profile page from the <em>Navbar</em> store, after successfully fetching data from the server. We obviously cannot navigate from within the component since no action has been fired yet and no character data has been received. There are certainly other ways to get <code>history</code> or <code>router</code> object references inside a Flux store, but this is the least complicated solution I could think of.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-02 17.06.40.png" alt=""></p>

<p><code>componentDidMount</code> is where we establish connection with Socket.IO and initialize <a href="https://api.jquery.com/ajaxStart/"><code>ajaxStart</code></a> and <a href="http://api.jquery.com/ajaxcomplete/"><code>ajaxComplete</code></a> event listeners used for fading in/out the loading indicator on AJAX requests, which is located next to the <strong>NEF</strong> logo.</p>

<style>
.triangles {
  display: inline-block;
  height: 27px;
  width: 30px;
  transform: translate(-50%, -50%);
}
.navbar-brand:hover .tri {
  animation-play-state: paused;
}
.tri {
  position: absolute;
  animation: pulse 750ms ease-in infinite;
  border-top: 9px solid #363f34;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 0;
}
.tri.invert {
  border-top: 0;
  border-bottom: 9px solid #363f34;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
}
.tri:nth-child(1) {
  left: 10px;
}
.tri:nth-child(2) {
  left: 5px;
  top: 9px;
  animation-delay: -125ms;
}
.tri:nth-child(3) {
  left: 10px;
  top: 9px;
}
.tri:nth-child(4) {
  left: 15px;
  top: 9px;
  animation-delay: -625ms;
}
.tri:nth-child(5) {
  top: 18px;
  animation-delay: -250ms;
}
.tri:nth-child(6) {
  top: 18px;
  left: 5px;
  animation-delay: -250ms;
}
.tri:nth-child(7) {
  top: 18px;
  left: 10px;
  animation-delay: -375ms;
}
.tri:nth-child(8) {
  top: 18px;
  left: 15px;
  animation-delay: -500ms;
}
.tri:nth-child(9) {
  top: 18px;
  left: 20px;
  animation-delay: -500ms;
}

@keyframes pulse {
  0% {
    opacity: 1;
  }
  16.666% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

@-webkit-keyframes pulse {
  0% {
    opacity: 1;
  }
  16.666% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

@-moz-keyframes pulse {
  0% {
    opacity: 1;
  }
  16.666% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
</style>

<div class="text-center">
  <div class="triangles">
    <div class="tri invert"></div>
    <div class="tri invert"></div>
    <div class="tri"></div>
    <div class="tri invert"></div>
    <div class="tri invert"></div>
    <div class="tri"></div>
    <div class="tri invert"></div>
    <div class="tri"></div>
    <div class="tri invert"></div>
  </div>
</div>

<p><code>handleSubmit</code> is a form submit handler that gets executed by pressing the <em>Enter</em> key or clicking the <em><i class="fa fa-search"></i> (Search)</em> button. It essentially does some input cleanup and validation, then fires the <code>findCharacter</code> action. In addition to the search query and the router instance, we also pass a reference to the search field DOM Node so that we could display a shaking animation when a character name is not found.</p>

<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Let's create a new file <em>NavbarActions.js</em> in the <strong><i class="fa fa-folder-open"></i>app/actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">assign</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'underscore'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">NavbarActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'updateOnlineUsers'</span><span class="p">,</span>
      <span class="s1">'updateAjaxAnimation'</span><span class="p">,</span>
      <span class="s1">'updateSearchQuery'</span><span class="p">,</span>
      <span class="s1">'getCharacterCountSuccess'</span><span class="p">,</span>
      <span class="s1">'getCharacterCountFail'</span><span class="p">,</span>
      <span class="s1">'findCharacterSuccess'</span><span class="p">,</span>
      <span class="s1">'findCharacterFail'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">findCharacter</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters/search'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">searchQuery</span> <span class="p">}</span>
    <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">assign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">findCharacterSuccess</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">findCharacterFail</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">getCharacterCount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters/count'</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getCharacterCountSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getCharacterCountFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">NavbarActions</span><span class="p">);</span>
</code></pre></div>
<p>Most of these actions should be pretty self-explanatory, but if it is unclear, see brief descriptions below.</p>

<table><thead>
<tr>
<th>Action</th>
<th style="text-align: center">Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>updateOnlineUsers</code></td>
<td style="text-align: center">Sets online users count on Socket.IO event update.</td>
</tr>
<tr>
<td><code>updateAjaxAnimation</code></td>
<td style="text-align: center">Adds "fadeIn" or "fadeOut" CSS class to the loading indicator.</td>
</tr>
<tr>
<td><code>updateSearchQuery</code></td>
<td style="text-align: center">Update search query value on keypress.</td>
</tr>
<tr>
<td><code>getCharacterCount</code></td>
<td style="text-align: center">Fetch total number of characters from the server.</td>
</tr>
<tr>
<td><code>getCharacterCountSuccess</code></td>
<td style="text-align: center">Returns total number of characters.</td>
</tr>
<tr>
<td><code>getCharacterCountFail</code></td>
<td style="text-align: center">Returns jQuery <a href="http://api.jquery.com/jQuery.ajax/#jqXHR"><code>jqXhr</code></a> object.</td>
</tr>
<tr>
<td><code>findCharacter</code></td>
<td style="text-align: center">Find a character by name.</td>
</tr>
</tbody></table>

<p>The reason why we add the <code>shake</code> CSS class and then remove it one second later is so that we could repeat this animation, otherwise if we just keep on adding the <code>shake</code> it will not animate again.</p>

<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Create a new file <em>NavbarStore.js</em> in the <strong><i class="fa fa-folder-open"></i>app/stores</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">NavbarActions</span> <span class="nx">from</span> <span class="s1">'../actions/NavbarActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">NavbarStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">NavbarActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">totalCharacters</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onlineUsers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">searchQuery</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ajaxAnimationClass</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onFindCharacterSuccess</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">payload</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">characterId</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onFindCharacterFail</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">payload</span><span class="p">.</span><span class="nx">searchForm</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'shake'</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">payload</span><span class="p">.</span><span class="nx">searchForm</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'shake'</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onUpdateOnlineUsers</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onlineUsers</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">onlineUsers</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onUpdateAjaxAnimation</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ajaxAnimationClass</span> <span class="o">=</span> <span class="nx">className</span><span class="p">;</span> <span class="c1">//fadein or fadeout</span>
  <span class="p">}</span>

  <span class="nx">onUpdateSearchQuery</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">searchQuery</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetCharacterCountSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">totalCharacters</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetCharacterCountFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">NavbarStore</span><span class="p">);</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> Changed <a href="https://github.com/rackt/react-router/blob/master/UPGRADE_GUIDE.md#navigation-mixin"><code>router.transitionTo</code></a> to <a href="https://github.com/rackt/react-router/blob/master/UPGRADE_GUIDE.md#navigation-mixin"><code>history.pushState</code></a> for page navigation.</p>

<p>Recall this line in the <em>Navbar</em> component that we created above:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">className=</span><span class="s">'form-control'</span> <span class="na">placeholder=</span><span class="s">{this.state.totalCharacters</span> <span class="err">+</span> <span class="err">'</span> <span class="na">characters</span><span class="err">'}</span> <span class="na">value=</span><span class="s">{this.state.searchQuery}</span> <span class="na">onChange=</span><span class="s">{NavbarActions.updateSearchQuery}</span> <span class="nt">/&gt;</span>
</code></pre></div>
<p>Since <a href="https://facebook.github.io/react/docs/forms.html#interactive-props"><code>onChange</code></a> handler returns and <em>event</em> object, we are using <code>event.target.value</code> to get the text field value inside <code>onUpdateSearchQuery</code> function.</p>

<p>Open <strong>App.js</strong> again and import the <em>Navbar</em> component:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Navbar</span> <span class="nx">from</span> <span class="s1">'./Navbar'</span><span class="p">;</span>
</code></pre></div>
<p>Then add <code>&lt;Navbar /&gt;</code> right before the <code>this.props.children</code> component:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div&gt;</span>
  <span class="nt">&lt;Navbar</span> <span class="na">history=</span><span class="s">{this.props.history}</span> <span class="nt">/&gt;</span>
  {this.props.children}
  <span class="nt">&lt;Footer</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p><strong>October 19, 2015 Update:</strong> If you recall, we created a <code>history</code> object via <code>createBrowserHistory</code> inside <em>main.js</em> and passed it as a prop to the <code>&lt;Router&gt;</code>. That's why this prop is available in the <em>App.js</em> component. Here, we are just passing it even further down to the <em>Navbar</em> component.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-04 13.02.12.png" alt=""></p>

<p>Since we haven't yet configured Socket.IO on the server or implemented any of the API routes, you will not see the total number of online visitors (<em>red circle next to the logo</em>) or total characters (<em>search placeholder text</em>).</p>

<h2 id="step-10-socket-io-real-time-user-count">Step 10. Socket.IO - Real-time User Count</h2>

<p>Unlike the previous section, this one will be fairly short and focused specifically on the server-side aspect of Socket.IO.</p>

<p>Open <em>server.js</em> and find the following line:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Express server listening on port '</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<p>Then replace it with the following code:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * Socket.io stuff.
 */</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">).</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'socket.io'</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">onlineUsers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connection'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">onlineUsers</span><span class="o">++</span><span class="p">;</span>

  <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'onlineUsers'</span><span class="p">,</span> <span class="p">{</span> <span class="na">onlineUsers</span><span class="p">:</span> <span class="nx">onlineUsers</span> <span class="p">});</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'disconnect'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">onlineUsers</span><span class="o">--</span><span class="p">;</span>
    <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'onlineUsers'</span><span class="p">,</span> <span class="p">{</span> <span class="na">onlineUsers</span><span class="p">:</span> <span class="nx">onlineUsers</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Express server listening on port '</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<p>In a nutshell, when a WebSocket connection is established, it increments the <code>onlineUsers</code> count (global variable) and broadcasts a message â€” <em>"Hey, I have this many online visitors now."</em>. When someone closes the browser and leaves, the <code>onlineUsers</code> count is decremented and it yet again broadcasts a message <em>"Hey, someone just left, I have this many online visitors now."</em>.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  If you have never used Socket.IO then <a href="http://socket.io/get-started/chat/">Chat application</a> tutorial is a great starting point.
</div>

<p>Open <em>index.html</em> in the <strong><i class="fa fa-folder-open"></i>views</strong> directory and add the following line right next with other scripts:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>
<p><img src="./tutorial_files/Screenshot 2015-07-04 13.02.15.png" alt=""></p>

<p>Refresh the browser and open <a href="http://localhost:3000/">http://localhost:3000</a> in multiple tabs to simulate multiple user connections. You should now see the total number of visitors in the red circle next to the logo.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-04 13.25.42.png" alt=""></p>

<p>At this point we are neither finished with the front-end nor do we have any working API endpoints. We could have focused on building just the front-end in the first half of the tutorial and then the back-end in the second half of the tutorial, or vice versa, but personally, I have never built an app like that. I typically go back and forth between back-end and front-end parts of the application during my development flow.</p>

<p>We can't display any characters until they are added to the database. In order to add new characters to the database we need to build a UI for it and implement an API endpoint. That's exactly what we will do next.</p>

<h2 id="step-11-add-character-component">Step 11. Add Character Component</h2>

<p>This component consists of a simple form with a text field, radio buttons and a submit button. Success and error messages will be displayed within <a href="http://getbootstrap.com/css/#forms-help-text"><code>help-block</code></a> under the text field.</p>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>AddCharacter.js</em> in <strong><i class="fa fa-folder-open"></i>app/components</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacterStore</span> <span class="nx">from</span> <span class="s1">'../stores/AddCharacterStore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacterActions</span> <span class="nx">from</span> <span class="s1">'../actions/AddCharacterActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">AddCharacter</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">AddCharacterStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">AddCharacterStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">AddCharacterStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">gender</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">gender</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">AddCharacterActions</span><span class="p">.</span><span class="nx">invalidName</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">nameTextField</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gender</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">AddCharacterActions</span><span class="p">.</span><span class="nx">invalidGender</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">gender</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">AddCharacterActions</span><span class="p">.</span><span class="nx">addCharacter</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">gender</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'row flipInX animated'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-sm-8'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'panel panel-default'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'panel-heading'</span><span class="o">&gt;</span><span class="nx">Add</span> <span class="nx">Character</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'panel-body'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="s1">'form-group '</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">nameValidationState</span><span class="p">}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'control-label'</span><span class="o">&gt;</span><span class="nx">Character</span> <span class="nx">Name</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'text'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'form-control'</span> <span class="nx">ref</span><span class="o">=</span><span class="s1">'nameTextField'</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
                           <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacterActions</span><span class="p">.</span><span class="nx">updateName</span><span class="p">}</span> <span class="nx">autoFocus</span><span class="o">/&gt;</span>
                    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'help-block'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">helpBlock</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="s1">'form-group '</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">genderValidationState</span><span class="p">}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'radio radio-inline'</span><span class="o">&gt;</span>
                      <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'radio'</span> <span class="nx">name</span><span class="o">=</span><span class="s1">'gender'</span> <span class="nx">id</span><span class="o">=</span><span class="s1">'female'</span> <span class="nx">value</span><span class="o">=</span><span class="s1">'Female'</span> <span class="nx">checked</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">gender</span> <span class="o">===</span> <span class="s1">'Female'</span><span class="p">}</span>
                             <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacterActions</span><span class="p">.</span><span class="nx">updateGender</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>                      <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="s1">'female'</span><span class="o">&gt;</span><span class="nx">Female</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'radio radio-inline'</span><span class="o">&gt;</span>
                      <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'radio'</span> <span class="nx">name</span><span class="o">=</span><span class="s1">'gender'</span> <span class="nx">id</span><span class="o">=</span><span class="s1">'male'</span> <span class="nx">value</span><span class="o">=</span><span class="s1">'Male'</span> <span class="nx">checked</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">gender</span> <span class="o">===</span> <span class="s1">'Male'</span><span class="p">}</span>
                             <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacterActions</span><span class="p">.</span><span class="nx">updateGender</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>                      <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="s1">'male'</span><span class="o">&gt;</span><span class="nx">Male</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'submit'</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'btn btn-primary'</span><span class="o">&gt;</span><span class="nx">Submit</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">AddCharacter</span><span class="p">;</span>
</code></pre></div>
<p>You should start to see by now what all these components have in common:</p>

<ol>
<li>Set the initial component state to what's in the store.</li>
<li>Add a store listener in <code>componentDidMount</code>, remove it in <code>componentWillUnmount</code>.</li>
<li>Add <code>onChange</code> method which updates component's state whenever the store is updated.</li>
</ol>

<p><code>handleSubmit</code> does exactly what you might think â€” handles the form submission for adding a new character. While it is true that we could have done form validation inside <code>addCharacter</code> action instead, however, doing so would also require us to pass the text field DOM reference, because when <code>nameTextField</code> is invalid, it needs to be "focused" so that a user can start typing again without having to click the text field.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-10 01.23.19.png" alt=""></p>

<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Create a new file <em>AddCharacterActions.js</em> in <strong><i class="fa fa-folder-open"></i>app/actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">AddCharacterActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'addCharacterSuccess'</span><span class="p">,</span>
      <span class="s1">'addCharacterFail'</span><span class="p">,</span>
      <span class="s1">'updateName'</span><span class="p">,</span>
      <span class="s1">'updateGender'</span><span class="p">,</span>
      <span class="s1">'invalidName'</span><span class="p">,</span>
      <span class="s1">'invalidGender'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">addCharacter</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">gender</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span> <span class="na">gender</span><span class="p">:</span> <span class="nx">gender</span> <span class="p">}</span>
    <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">addCharacterSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">addCharacterFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">AddCharacterActions</span><span class="p">);</span>
</code></pre></div>
<p>We are firing <code>addCharacterSuccess</code> action when character has been added to the database successfully and <code>addCharacterFail</code> when character could not be added, perhaps due to an invalid name or because it already exists in the database. Both <code>updateName</code> and <code>updateGender</code> actions are fired when the <em>Character Name</em> text field and <em>Gender</em> radio button is updated via <code>onChange</code>, respectively. And likewise, <code>invalidName</code> and <code>invalidGender</code> actions are fired when you a user submits the form without entering a name or selecting a gender.</p>

<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Create a new file <em>AddCharacterStore.js</em> in <strong><i class="fa fa-folder-open"></i>app/stores</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacterActions</span> <span class="nx">from</span> <span class="s1">'../actions/AddCharacterActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">AddCharacterStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">AddCharacterActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpBlock</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nameValidationState</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">genderValidationState</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onAddCharacterSuccess</span><span class="p">(</span><span class="nx">successMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nameValidationState</span> <span class="o">=</span> <span class="s1">'has-success'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpBlock</span> <span class="o">=</span> <span class="nx">successMessage</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onAddCharacterFail</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nameValidationState</span> <span class="o">=</span> <span class="s1">'has-error'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpBlock</span> <span class="o">=</span> <span class="nx">errorMessage</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onUpdateName</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nameValidationState</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpBlock</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onUpdateGender</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">genderValidationState</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onInvalidName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nameValidationState</span> <span class="o">=</span> <span class="s1">'has-error'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpBlock</span> <span class="o">=</span> <span class="s1">'Please enter a character name.'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onInvalidGender</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">genderValidationState</span> <span class="o">=</span> <span class="s1">'has-error'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">AddCharacterStore</span><span class="p">);</span>
</code></pre></div>
<p><code>nameValidationState</code> and <code>genderValidationState</code> refers to the <a href="http://getbootstrap.com/css/#forms-control-validation">validation states</a> on form controls provided by Bootstrap.  </p>

<p><code>helpBlock</code> is a status message which gets displayed below the text field, e.g. <em>Character has been added successfully</em>.</p>

<p><code>onInvalidName</code> handler is fired when <em>Character Name</em> field is empty. If the name does not exist in EVE Online database it will be a different error message provided by <code>onAddCharacterFail</code> handler.</p>

<p>Finally, open <em>routes.js</em> and add a new route <code>/add</code> with the <code>AddCharacter</code> component handler:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">'./components/Home'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacter</span> <span class="nx">from</span> <span class="s1">'./components/AddCharacter'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Home</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/add'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacter</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div>
<p>Here is a quick demonstration of the entire flow from the moment you start typing a character's name:</p>

<ol>
<li>Fire <code>updateName</code> action, passing the <em>event</em> object as its payload.</li>
<li>Call <code>onUpdateName</code> store handler.</li>
<li>Update the state with the new name.</li>
</ol>

<p><img src="./tutorial_files/Screenshot 2015-07-15 15.34.55.png" alt=""></p>

<p>In the next few sections we will implement the back-end code for adding and saving new characters to the database.</p>

<h2 id="step-12-database-schema">Step 12. Database Schema</h2>

<p>In the top-level directory (next to <em>package.json</em> and <em>server.js</em> files) create a new folder <strong><i class="fa fa-folder-open"></i>models</strong>, then inside create a new file <em>character.js</em> and paste the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">characterSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
  <span class="na">characterId</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">race</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">gender</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">bloodline</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">wins</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
  <span class="na">losses</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
  <span class="na">reports</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
  <span class="na">random</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="p">[</span><span class="nb">Number</span><span class="p">],</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'2d'</span> <span class="p">},</span>
  <span class="na">voted</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Character'</span><span class="p">,</span> <span class="nx">characterSchema</span><span class="p">);</span>
</code></pre></div>
<p><img src="./tutorial_files/Screenshot 2015-07-10 17.04.51.png" alt=""></p>

<p>A schema is just a representation of your data in MongoDB. This is where you can enforce a certain field to be of particular type. A field can also be required, unique or contain only specified characters.</p>

<p>While a schema is just an abstract representation of the data, a model on the other hand is a more practical object with methods to query, remove, update and save data from/to MongoDB. Above, we create a <code>Character</code> model and immediately export it.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  Why yet another tutorial using MongoDB? Why not use MySQL, PostgreSQL, CouchDB or even <a href="http://rethinkdb.com/">RethinkDB</a>? That's because I don't really care enough about the database layer for the types of apps I am building. I would much rather focus on the front-end stack, because that's one of my primary interests, not databases. MongoDB may not best-suited for all use cases, but it's a decent general-purpose database and it has worked well for me in the past 3 years.
</div>

<p>Most of these fields are pretty self-explanatory, but <code>random</code> and <code>voted</code> may need some context:</p>

<ul>
<li><code>random</code> - an array of two numbers generated by <code>[Math.random(), 0]</code>. It is a <a href="http://docs.mongodb.org/manual/applications/geospatial-indexes/">geospatial</a> point as far as MongoDB is concerned. In order to grab a random character from the database we are going to use the <a href="http://docs.mongodb.org/manual/reference/operator/query/near/"><code>$near</code></a> operator. I found about this "trick" from <a href="http://stackoverflow.com/questions/2824157/random-record-from-mongodb">Random record from MongoDB</a> on StackOverflow.</li>
<li><code>voted</code> - a boolean for identifying which characters have already been voted. Previously, people were abusing the website by voting for the same character multiple times in a row. But now, when querying for two characters, only those characters that have not been voted will be fetched. Even if someone were to hit the API directly, a vote will not count for already voted characters.</li>
</ul>

<p>Back in <em>server.js</em>, add the following lines at the beginning of the file, along with all other module dependencies:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Character</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./models/character'</span><span class="p">);</span>
</code></pre></div>
<p>Just to be consistent and systematic, I usually organize my module imports in the following order:</p>

<ol>
<li>Core Node.js modules â€” <em>path</em>, <em>querystring</em>, <em>http</em>.</li>
<li>Third-party NPM libraries â€” <em>mongoose</em>, <em>express</em>, <em>request</em>.</li>
<li>Application files â€” <em>controllers</em>, <em>models</em>, <em>config</em>.</li>
</ol>

<p>And finally, to connect to the database, add the following code somewhere between module dependencies and Express middlewares. This will establish a connection pool with MongoDB when we start the Express app.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">database</span><span class="p">);</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">'Error: Could not connect to MongoDB. Did you forget to run `mongod`?'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
  We will set the database hostname in <em>config.js</em> to avoid hard-coding the value here.
</div>

<p>Create another file in the top-level directory called <em>config.js</em> and paste the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">database</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_URI</span> <span class="o">||</span> <span class="s1">'localhost/nef'</span>
<span class="p">};</span>
</code></pre></div>
<p><strong>January 13, 2016 Update:</strong> Use <code>localhost/nef</code> database, because that is where we are going to import characters in the next section.</p>

<p>It will use an environment variable (if available) and fallback to "localhost/nef". Using this approach allows us to use one hostname for local development and another hostname for production without updating any code, and it is especially useful when <a href="https://github.com/sahat/hackathon-starter/blob/master/config/secrets.js">dealing with OAuth client keys and client secrets</a>.</p>

<p>Now let's import it back in <em>server.js</em>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./config'</span><span class="p">);</span>
</code></pre></div>
<p>Open a new tab in Terminal and run <code>mongod</code>. If you are on Windows, you will need to open <em>mongod.exe</em> in the directory where you installed MongoDB.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-13 13.40.40.png" alt=""></p>

<h2 id="step-13-express-api-routes-1-of-2">Step 13. Express API Routes (1 of 2)</h2>

<p>In this section we will implement an Express route for fetching character information and storing it in database. We will be using <a href="http://wiki.eve-id.net/APIv2_Page_Index">EVE Online API</a> for fetching <em>Character ID</em>, <em>Race</em> and <em>Bloodline</em> for a given character name.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  Character gender is not a public data; it requires an API key. In my opinion, what makes New Eden Faces so great is its open nature - a user does not need to be authenticated and anyone can add any other character to the roster. That is why we have two radio buttons for gender selection on the <em>Add Character</em> page. It does depend on user's honesty, however.
</div>

<p>Below is a table that outlines each route's responsibility. However, we will not be implementing all routes, because that is something you can do on your own if necessary.</p>

<table><thead>
<tr>
<th>Route</th>
<th style="text-align: center">POST</th>
<th style="text-align: right">GET</th>
<th style="text-align: right">PUT</th>
<th style="text-align: right">DELETE</th>
</tr>
</thead><tbody>
<tr>
<td><em>/api/characters</em></td>
<td style="text-align: center">Add a new character</td>
<td style="text-align: right">Get random two characters</td>
<td style="text-align: right">Update wins/losses for two characters</td>
<td style="text-align: right">Delete all characters</td>
</tr>
<tr>
<td><em>/api/characters/:id</em></td>
<td style="text-align: center">N/A</td>
<td style="text-align: right">Get a character</td>
<td style="text-align: right">Update a character</td>
<td style="text-align: right">Delete a character</td>
</tr>
</tbody></table>

<p>In <em>server.js</em> add the following dependencies at the top:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'async'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'request'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">xml2js</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'xml2js'</span><span class="p">);</span>
</code></pre></div>
<p>We will use <a href="https://github.com/caolan/async#waterfalltasks-callback">async.waterfall</a> for managing multiple asynchronous operations and <a href="https://github.com/request/request">request</a> module for making HTTP requests to the EVE Online API.</p>

<p>Add our first route right after Express middlewares but before the "React middleware" that we created earlier in <strong>Step 8. React Routes (Server-Side)</strong>.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * POST /api/characters
 * Adds new character to the database.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/api/characters'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">gender</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">gender</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">characterName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">characterIdLookupUrl</span> <span class="o">=</span> <span class="s1">'https://api.eveonline.com/eve/CharacterID.xml.aspx?names='</span> <span class="o">+</span> <span class="nx">characterName</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">xml2js</span><span class="p">.</span><span class="nx">Parser</span><span class="p">();</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">waterfall</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">characterIdLookupUrl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">xml</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">parser</span><span class="p">.</span><span class="nx">parseString</span><span class="p">(</span><span class="nx">xml</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">parsedXml</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">characterId</span> <span class="o">=</span> <span class="nx">parsedXml</span><span class="p">.</span><span class="nx">eveapi</span><span class="p">.</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">rowset</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">row</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$</span><span class="p">.</span><span class="nx">characterID</span><span class="p">;</span>

            <span class="nx">Character</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">characterId</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">409</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="nx">character</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' is already in the database.'</span> <span class="p">});</span>
              <span class="p">}</span>

              <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characterId</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'XML Parse Error'</span> <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">characterId</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">characterInfoUrl</span> <span class="o">=</span> <span class="s1">'https://api.eveonline.com/eve/CharacterInfo.xml.aspx?characterID='</span> <span class="o">+</span> <span class="nx">characterId</span><span class="p">;</span>

      <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="nx">characterInfoUrl</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">xml</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">parser</span><span class="p">.</span><span class="nx">parseString</span><span class="p">(</span><span class="nx">xml</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">parsedXml</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">parsedXml</span><span class="p">.</span><span class="nx">eveapi</span><span class="p">.</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">characterName</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">race</span> <span class="o">=</span> <span class="nx">parsedXml</span><span class="p">.</span><span class="nx">eveapi</span><span class="p">.</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">race</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">bloodline</span> <span class="o">=</span> <span class="nx">parsedXml</span><span class="p">.</span><span class="nx">eveapi</span><span class="p">.</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">bloodline</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

            <span class="kd">var</span> <span class="nx">character</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Character</span><span class="p">({</span>
              <span class="na">characterId</span><span class="p">:</span> <span class="nx">characterId</span><span class="p">,</span>
              <span class="na">name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span>
              <span class="na">race</span><span class="p">:</span> <span class="nx">race</span><span class="p">,</span>
              <span class="na">bloodline</span><span class="p">:</span> <span class="nx">bloodline</span><span class="p">,</span>
              <span class="na">gender</span><span class="p">:</span> <span class="nx">gender</span><span class="p">,</span>
              <span class="na">random</span><span class="p">:</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">});</span>

            <span class="nx">character</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="nx">characterName</span> <span class="o">+</span> <span class="s1">' has been added successfully!'</span> <span class="p">});</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="nx">characterName</span> <span class="o">+</span> <span class="s1">' is not a registered citizen of New Eden.'</span> <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
  I typically add block comments above my routes specifying the full path and a brief description. This allows me to quickly find the routes I am looking for using the <strong>Find...(âŒ˜F)</strong> command as shown below.
</div>

<p><img src="./tutorial_files/Screenshot 2015-07-15 09.31.03.png" alt=""></p>

<p>Here is a step-by-step breakdown of how it works:</p>

<ol>
<li>Get a <em>Character ID</em> from a <em>Character Name</em>.
<img src="./tutorial_files/Screenshot 2015-07-14 19.39.00.png" alt=""></li>
<li>Parse XML response.</li>
<li>Query the database to check if this character is already in the database.</li>
<li>Pass <em>Character ID</em> to the next function in the <a href="https://github.com/caolan/async#waterfall"><code>async.waterfall</code></a> stage.</li>
<li>Get basic character information from a <em>Character ID</em>.
<img src="./tutorial_files/Screenshot 2015-07-14 19.49.46.png" alt=""></li>
<li>Parse XML response.</li>
<li>Add a new character to the database.</li>
</ol>

<p>Go to <a href="http://localhost:3000/add">http://localhost:3000/add</a> then add a few characters. You could use some of the following names:</p>

<ul>
<li>Daishan Auergni</li>
<li>CCP Falcon</li>
<li>Celeste Taylor</li>
</ul>

<blockquote>
<p><strong>Note:</strong> You can find additional character names over in the <a href="https://forums.eveonline.com/default.aspx?g=topics&amp;f=258">EVE Online Forums</a>.</p>
</blockquote>

<p><img src="./tutorial_files/Screenshot 2015-07-15 14.05.53.png" alt=""></p>

<p>Or better yet, download this MongoDB file dump that contains over 4000 characters and import it into your database. Please ignore "duplicate key errors" if you have already added some of the characters earlier.</p>

<ul>
<li><a href="https://dl.dropboxusercontent.com/u/14131013/newedenfaces.bson"><i class="fa fa-cloud-download"></i> newedenfaces.bson</a></li>
</ul>

<p>In Terminal, navigate to where this file has been downloaded, then run the following command to import the characters into MongoDB:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>mongorestore newedenfaces.bson -d nef -c characters
</code></pre></div>
<p><strong>October 11, 2015 Update:</strong> Use explicit <em>database</em> and <em>collection</em> flags in the command above.</p>

<p>You will not see updated character count in the search field just yet, since we haven't implemented an API endpoint for it. We will do that after the next section.</p>

<p>Next, let's create the <em>Home</em> component - initial page that displays 2 characters side by side.</p>

<h2 id="step-14-home-component">Step 14. Home Component</h2>

<p>This is one of the simpler components whose only responsibility is to display 2 images and handle click events to know which one is the winning and which one is the losing character between the two.</p>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>Home.js</em> inside <strong><i class="fa fa-folder-open"></i>components</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Link</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">HomeStore</span> <span class="nx">from</span> <span class="s1">'../stores/HomeStore'</span>
<span class="kr">import</span> <span class="nx">HomeActions</span> <span class="nx">from</span> <span class="s1">'../actions/HomeActions'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">first</span><span class="p">,</span> <span class="nx">without</span><span class="p">,</span> <span class="nx">findWhere</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'underscore'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Home</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">HomeStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">HomeStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">HomeActions</span><span class="p">.</span><span class="nx">getTwoCharacters</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">HomeStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">loser</span> <span class="o">=</span> <span class="nx">first</span><span class="p">(</span><span class="nx">without</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characters</span><span class="p">,</span> <span class="nx">findWhere</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characters</span><span class="p">,</span> <span class="p">{</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">winner</span> <span class="p">}))).</span><span class="nx">characterId</span><span class="p">;</span>
    <span class="nx">HomeActions</span><span class="p">.</span><span class="nx">vote</span><span class="p">(</span><span class="nx">winner</span><span class="p">,</span> <span class="nx">loser</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">characterNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characters</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">character</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="s1">'col-xs-6 col-sm-6 col-md-5 col-md-offset-1'</span> <span class="p">:</span> <span class="s1">'col-xs-6 col-sm-6 col-md-5'</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'thumbnail fadeInUp animated'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">character</span><span class="p">)}</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'http://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_512.jpg'</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'caption text-center'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-inline'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="na">Race</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/strong&gt; {character.race}&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="na">Bloodline</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/strong&gt; {character.bloodline}&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">Link</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h3</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'text-center'</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">portrait</span><span class="p">.</span> <span class="nx">Select</span> <span class="nx">your</span> <span class="nx">favorite</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'row'</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">characterNodes</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Home</span><span class="p">;</span>
</code></pre></div>
<p><strong>July 27, 2015 Update:</strong> Fixed the error <em>Cannot read property 'characterId' of undefined</em>. I have updated how the "losing" Character ID is obtained inside <code>handleClick()</code> method. It uses <a href="http://underscorejs.org/#findWhere"><code>_.findWhere</code></a> to find the "winning" character object within the array, then using <a href="http://underscorejs.org/#without"><code>_.without</code></a> we get a new array without the "winning" character. Since we only have 2 characters in the array, the other object must be the "losing" character. And finally, using <a href="http://underscorejs.org/#first"><code>_.first</code></a> we get the first (and only) object in the array.</p>

<p>It is not really necessary to map over the <code>characters</code> array since we only have 2 characters to display, but it is one way to do it. Another way would be to create a separate markup for <code>characters[0]</code> and <code>characters[1]</code> like so:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h3</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'text-center'</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">portrait</span><span class="p">.</span> <span class="nx">Select</span> <span class="nx">your</span> <span class="nx">favorite</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'row'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-xs-6 col-sm-6 col-md-5 col-md-offset-1'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'thumbnail fadeInUp animated'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">characters</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'http://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="nx">characters</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_512.jpg'</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'caption text-center'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-inline'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Race</span><span class="err">:</span><span class="o">&lt;</span><span class="sr">/strong&gt; {characters</span><span class="se">[</span><span class="sr">0</span><span class="se">]</span><span class="sr">.race}&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Bloodline</span><span class="err">:</span><span class="o">&lt;</span><span class="sr">/strong&gt; {characters</span><span class="se">[</span><span class="sr">0</span><span class="se">]</span><span class="sr">.bloodline}&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">characters</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">characters</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">Link</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-xs-6 col-sm-6 col-md-5'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'thumbnail fadeInUp animated'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">characters</span><span class="p">[</span><span class="mi">1</span><span class="p">])}</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'http://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="nx">characters</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_512.jpg'</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'caption text-center'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-inline'</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Race</span><span class="err">:</span><span class="o">&lt;</span><span class="sr">/strong&gt; {characters</span><span class="se">[</span><span class="sr">1</span><span class="se">]</span><span class="sr">.race}&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Bloodline</span><span class="err">:</span><span class="o">&lt;</span><span class="sr">/strong&gt; {characters</span><span class="se">[</span><span class="sr">1</span><span class="se">]</span><span class="sr">.bloodline}&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">characters</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">characters</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">Link</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
</code></pre></div>
<p>The first image is offset via <code>col-md-offset-1</code> Bootstrap CSS class so both images are perfectly center-aligned.</p>

<p>Notice we are not just binding <code>this.handleClick</code> to a click event, but instead we do <code>{this.handleClick.bind(this, character)</code>. Simply passing an <em>event</em> object is not enough, it will not give us any useful information, unlike text field, checkbox or radio button group elements.</p>

<p>From the <a href="https://msdn.microsoft.com/en-us/library/ff841995%28v=vs.94%29.ASPx?f=255&amp;MSPPError=-2147217396">MSDN Documentation</a>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">[,</span> <span class="nx">arg1</span><span class="p">[,</span> <span class="nx">arg2</span><span class="p">[,</span> <span class="p">...]]])</span>
</code></pre></div>
<ul>
<li><strong>thisArg (Required)</strong> - An object to which the <code>this</code> keyword can refer inside the new function.</li>
<li><strong>arg1, arg2, ... (Optional)</strong> - A list of arguments to be passed to the new function.</li>
</ul>

<p>To put it simply, we need to pass <code>this</code> context because we are referencing <code>this.state</code> inside <code>handleClick</code> method, we are passing a custom object containing character information that was clicked instead of the default <em>event</em> object.</p>

<p>Inside <code>handleClick</code> method, the <code>character</code> parameter is our winning character, because that's the character that was clicked on. Since we only have two characters it is not that hard to figure out the losing character. We then pass both <code>winner</code> and <code>loser</code> <em>Character IDs</em> to the <code>HomeActions.vote</code> action.</p>

<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Create a new file <em>HomeActions.js</em> inside <strong><i class="fa fa-folder-open"></i>actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">HomeActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'getTwoCharactersSuccess'</span><span class="p">,</span>
      <span class="s1">'getTwoCharactersFail'</span><span class="p">,</span>
      <span class="s1">'voteFail'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getTwoCharacters</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters'</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getTwoCharactersSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="nx">jqXhr</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getTwoCharactersFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">vote</span><span class="p">(</span><span class="nx">winner</span><span class="p">,</span> <span class="nx">loser</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'PUT'</span><span class="p">,</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters'</span> <span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">winner</span><span class="p">:</span> <span class="nx">winner</span><span class="p">,</span> <span class="na">loser</span><span class="p">:</span> <span class="nx">loser</span> <span class="p">}</span>
    <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getTwoCharacters</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">voteFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">HomeActions</span><span class="p">);</span>
</code></pre></div>
<p>We do not need <code>voteSuccess</code> action here because <code>getTwoCharacters</code> already does exactly what we need. In other words, after a successful vote, we need to fetch two more random characters from the database.</p>

<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Create a new file <em>HomeStore.js</em> inside <strong><i class="fa fa-folder-open"></i>stores</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">HomeActions</span> <span class="nx">from</span> <span class="s1">'../actions/HomeActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">HomeStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">HomeActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characters</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>

  <span class="nx">onGetTwoCharactersSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characters</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetTwoCharactersFail</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onVoteFail</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">HomeStore</span><span class="p">);</span>
</code></pre></div>
<p>Next, let's implement the remaining Express routes for fetching and updating two characters in <em>Home</em> component, retrieving total characters count and more.
&lt;!-- And there you have it. Refresh the browser once again and you should see two character images on the home page. Try clicking on one of them. After clicking on one of the images you should see a new set of characters appear. --&gt;</p>

<h2 id="step-15-express-api-routes-2-of-2">Step 15. Express API Routes (2 of 2)</h2>

<p>Switch back to <em>server.js</em>. I hope it is clear by now where you need to include all of the following routes - after Express middlewares but before the "React middleware".</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  Understand that we are including all routes in <em>server.js</em> because it is convenient to do so for the purposes of this tutorial. In the dashboard project that I had to build at work, all routes were split into separate files inside the <strong><i class="fa fa-folder-open"></i>routes</strong> directory, furthermore all route handlers were split into separate files inside the <strong><i class="fa fa-folder-open"></i>controllers</strong> directory.
</div>

<p>Let's start with the route for fetching two characters in the <em>Home</em> component.</p>

<p><strong>GET /api/characters</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/characters
 * Returns 2 random characters of the same gender that have not been voted yet.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/characters'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'Male'</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">randomGender</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sample</span><span class="p">(</span><span class="nx">choices</span><span class="p">);</span>

  <span class="nx">Character</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">random</span><span class="p">:</span> <span class="p">{</span> <span class="na">$near</span><span class="p">:</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="mi">0</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'voted'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'gender'</span><span class="p">,</span> <span class="nx">randomGender</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characters</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">characters</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">characters</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">oppositeGender</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">choices</span><span class="p">,</span> <span class="nx">randomGender</span><span class="p">));</span>

      <span class="nx">Character</span>
        <span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">random</span><span class="p">:</span> <span class="p">{</span> <span class="na">$near</span><span class="p">:</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="mi">0</span><span class="p">]</span> <span class="p">}</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'voted'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'gender'</span><span class="p">,</span> <span class="nx">oppositeGender</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characters</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">characters</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">characters</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">Character</span><span class="p">.</span><span class="nx">update</span><span class="p">({},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">voted</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">([]);</span>
          <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>Be sure to add the <a href="http://underscorejs.org/">Underscore.js</a> module at the top, since we are using it for <a href="http://underscorejs.org/#sample"><code>_.sample()</code></a>, <a href="http://underscorejs.org/#first"><code>_.first()</code></a> and <a href="http://underscorejs.org/#without"><code>_.without()</code></a> functions:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'underscore'</span><span class="p">);</span>
</code></pre></div>
<p>I have tried to make this code as readable as possible, so it should be fairly easy to understand how it fetches two random characters. It will randomly select <em>Male</em> or <em>Female</em> gender and query the database for two characters. If we get back less than 2 characters, it will attempt another query with the opposite gender. For example, if we have 10 male characters and 9 of them have already been voted, displaying 1 character makes no sense. If don't get back 2 characters for either <em>Male</em> or <em>Female</em> gender, that means we have exhausted all unvoted characters and the vote count should be reset by setting <code>voted: false</code> for all characters.</p>

<hr>

<p><strong>PUT /api/characters</strong></p>

<p>This route is related to the previous one since it updates <code>wins</code> and <code>losses</code> fields of winning and losing characters respectively.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * PUT /api/characters
 * Update winning and losing count for both characters.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">'/api/characters'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">winner</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">loser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">loser</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">winner</span> <span class="o">||</span> <span class="o">!</span><span class="nx">loser</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'Voting requires two characters.'</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">winner</span> <span class="o">===</span> <span class="nx">loser</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'Cannot vote for and against the same character.'</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">([</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">winner</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">winner</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">winner</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">loser</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">loser</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">loser</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">loser</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">winner</span> <span class="o">||</span> <span class="o">!</span><span class="nx">loser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'One of the characters no longer exists.'</span> <span class="p">});</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">winner</span><span class="p">.</span><span class="nx">voted</span> <span class="o">||</span> <span class="nx">loser</span><span class="p">.</span><span class="nx">voted</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="nx">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">([</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">winner</span><span class="p">.</span><span class="nx">wins</span><span class="o">++</span><span class="p">;</span>
          <span class="nx">winner</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">winner</span><span class="p">.</span><span class="nx">random</span> <span class="o">=</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="mi">0</span><span class="p">];</span>
          <span class="nx">winner</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">},</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">loser</span><span class="p">.</span><span class="nx">losses</span><span class="o">++</span><span class="p">;</span>
          <span class="nx">loser</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">loser</span><span class="p">.</span><span class="nx">random</span> <span class="o">=</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="mi">0</span><span class="p">];</span>
          <span class="nx">loser</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>Here we are using <a href="https://github.com/caolan/async#paralleltasks-callback"><code>async.parallel</code></a> to make two database queries simultaneously, since one query does not depend on another. However, because we have two separate MongoDB documents, that's two independent asynchronous operations, hence another <code>async.parallel</code>. Basically, we respond with a success only when both characters have finished updating and there were no errors.</p>

<hr>

<p><strong>GET /api/characters/count</strong></p>

<p>MongoDB has a built-in <a href="http://docs.mongodb.org/manual/reference/method/db.collection.count/"><code>count()</code></a> method for returning the number of results that match the query.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/characters/count
 * Returns the total number of characters.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/characters/count'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">count</span><span class="p">:</span> <span class="nx">count</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
  You may notice we are starting to diverge from the RESTful API design pattern with this one-off route for returning total count. Unfortunately that's just a reality. I have never worked on a project where I could perfectly map out all URLs in a RESTful way. See <a href="https://blog.apigee.com/detail/restful_api_design_what_about_counts">this post</a> by Apigee.
</div>

<hr>

<p><strong>GET/api/characters/search</strong></p>

<p>Last I checked MongoDB does not support case-insensitive queries, which explains why we have to use a regex here. The next best thing you could do is to use the <a href="http://docs.mongodb.org/manual/reference/operator/query/regex/"><code>$regex</code></a> operator.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/characters/search
 * Looks up a character by name. (case-insensitive)
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/characters/search'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">characterName</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">);</span>

  <span class="nx">Character</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nx">characterName</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'Character not found.'</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">character</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<p><strong>GET /api/characters/top</strong></p>

<p>When I first built this project, I initially had around 7-9 almost identical routes for retrieving the Top 100 characters. After some code refactoring I ended up with just a single route below.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/characters/top
 * Return 100 highest ranked characters. Filter by gender, race and bloodline.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/characters/top'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">conditions</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">conditions</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">Character</span>
    <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">conditions</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="s1">'-wins'</span><span class="p">)</span> <span class="c1">// Sort in descending order (highest wins on top)</span>
    <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characters</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

      <span class="c1">// Sort by winning percentage</span>
      <span class="nx">characters</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">wins</span> <span class="o">/</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">wins</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">wins</span> <span class="o">/</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">wins</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">losses</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">wins</span> <span class="o">/</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">wins</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">losses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">wins</span> <span class="o">/</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">wins</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">losses</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">});</span>

      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">characters</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>For example, if we are interested in the Top 100 male characters with Caldari race and Civire bloodline, this would be the URL path for it:</p>

<blockquote>
<p>GET /api/characters/top?race=caldari&amp;bloodline=civire&amp;gender=male</p>
</blockquote>

<p><img src="./tutorial_files/Screenshot 2015-07-17 18.16.21.png" alt=""></p>

<p>If you are still having trouble understanding how we construct the <code>conditions</code> object, this documented code should clarify it:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Query params object</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">race</span><span class="p">:</span> <span class="s1">'caldari'</span><span class="p">,</span>
  <span class="na">bloodline</span><span class="p">:</span> <span class="s1">'civire'</span><span class="p">,</span>
  <span class="na">gender</span><span class="p">:</span> <span class="s1">'male'</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">conditions</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// This each loop is equivalent...</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">conditions</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// To this code</span>
<span class="nx">conditions</span><span class="p">.</span><span class="nx">race</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">race</span> <span class="o">+</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">);</span> <span class="c1">// /caldari$/i</span>
<span class="nx">conditions</span><span class="p">.</span><span class="nx">bloodline</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">bloodline</span> <span class="o">+</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">);</span> <span class="c1">// /civire$/i</span>
<span class="nx">conditions</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">gender</span> <span class="o">+</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">);</span> <span class="c1">// /male$/i</span>

<span class="c1">// Which ultimately becomes this...</span>
<span class="nx">Character</span>
    <span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">race</span><span class="p">:</span> <span class="sr">/caldari$/i</span><span class="p">,</span> <span class="na">bloodline</span><span class="p">:</span> <span class="sr">/civire$/i</span><span class="p">,</span> <span class="na">gender</span><span class="p">:</span> <span class="sr">/male$/i</span> <span class="p">})</span>
</code></pre></div>
<p>After we retrieve characters with the highest number of wins, we are doing another sort by winning percentage, so that we don't end up with the oldest characters always being on top.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  Be careful with accepting user's input directly. Ideally we should have first checked for query params before blindly constructing the <code>conditions</code> object and passing it to MongoDB.
</div>

<hr>

<p><strong>GET /api/characters/shame</strong></p>

<p>Similar to the previous route, this one retrieves 100 characters with the most losses.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/characters/shame
 * Returns 100 lowest ranked characters.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/characters/shame'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Character</span>
    <span class="p">.</span><span class="nx">find</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="s1">'-losses'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characters</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">characters</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<p><strong>GET /api/characters/:id</strong></p>

<p><strong>October 11, 2015 Update:</strong> I have left this Express route for last, so that other routes starting with <em>/api/characters/</em>, do not get clobbered by the this route with the <code>:id</code> parameter.</p>

<p>This route is used by the profile page (<em>Character</em> component that we will build next) as shown at the beginning of the tutorial.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/characters/:id
 * Returns detailed character information.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/characters/:id'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

  <span class="nx">Character</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">id</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'Character not found.'</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">character</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<p><strong>POST /api/report</strong></p>

<p>Some characters do not have a valid avatar (gray silhouette) while other avatars are nearly pitch-black and shouldn't be added to the database in the first place. But since anyone can add everyone, sometimes you end up with those characters that need be removed. A character that has been reported by visitors at least 4 times will be removed from the database.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * POST /api/report
 * Reports a character. Character is removed after 4 reports.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/api/report'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">characterId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">characterId</span><span class="p">;</span>

  <span class="nx">Character</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">characterId</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'Character not found.'</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">character</span><span class="p">.</span><span class="nx">reports</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">character</span><span class="p">.</span><span class="nx">reports</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">character</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="nx">character</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' has been deleted.'</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">character</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="nx">character</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' has been reported.'</span> <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<p><strong>GET /api/stats</strong></p>

<p>And last but not least, a route for character stats. Yes, it could be simplified with <a href="https://github.com/caolan/async#each"><code>async.each</code></a> or <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promises</a>, but keep in mind when I first built New Eden Faces I was not familiar with either solutions. Most of the back-end code is unchanged since then. Although the code is verbose, at least it is explicit and very readable.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/**
 * GET /api/stats
 * Returns characters statistics.
 */</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/api/stats'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">([</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">count</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({</span> <span class="na">race</span><span class="p">:</span> <span class="s1">'Amarr'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">amarrCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">amarrCount</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({</span> <span class="na">race</span><span class="p">:</span> <span class="s1">'Caldari'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">caldariCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">caldariCount</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({</span> <span class="na">race</span><span class="p">:</span> <span class="s1">'Gallente'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">gallenteCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">gallenteCount</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({</span> <span class="na">race</span><span class="p">:</span> <span class="s1">'Minmatar'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">minmatarCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">minmatarCount</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({</span> <span class="na">gender</span><span class="p">:</span> <span class="s1">'Male'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">maleCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">maleCount</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">count</span><span class="p">({</span> <span class="na">gender</span><span class="p">:</span> <span class="s1">'Female'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">femaleCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">femaleCount</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">({</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="s1">'$wins'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">totalVotes</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">totalVotes</span><span class="p">.</span><span class="nx">length</span> <span class="p">?</span> <span class="nx">totalVotes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">total</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">total</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="s1">'-wins'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'race'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characters</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">raceCount</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">countBy</span><span class="p">(</span><span class="nx">characters</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">character</span><span class="p">.</span><span class="nx">race</span><span class="p">;</span> <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">raceCount</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">race</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">race</span> <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">inverted</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span><span class="nx">raceCount</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">topRace</span> <span class="o">=</span> <span class="nx">inverted</span><span class="p">[</span><span class="nx">max</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">topCount</span> <span class="o">=</span> <span class="nx">raceCount</span><span class="p">[</span><span class="nx">topRace</span><span class="p">];</span>

            <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">{</span> <span class="na">race</span><span class="p">:</span> <span class="nx">topRace</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="nx">topCount</span> <span class="p">});</span>
          <span class="p">});</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Character</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="s1">'-wins'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'bloodline'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">characters</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">bloodlineCount</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">countBy</span><span class="p">(</span><span class="nx">characters</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">character</span><span class="p">.</span><span class="nx">bloodline</span><span class="p">;</span> <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bloodlineCount</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bloodline</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">bloodline</span> <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">inverted</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span><span class="nx">bloodlineCount</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">topBloodline</span> <span class="o">=</span> <span class="nx">inverted</span><span class="p">[</span><span class="nx">max</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">topCount</span> <span class="o">=</span> <span class="nx">bloodlineCount</span><span class="p">[</span><span class="nx">topBloodline</span><span class="p">];</span>

            <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">{</span> <span class="na">bloodline</span><span class="p">:</span> <span class="nx">topBloodline</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="nx">topCount</span> <span class="p">});</span>
          <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">totalCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="na">amarrCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="na">caldariCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="na">gallenteCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="na">minmatarCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="na">maleCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
        <span class="na">femaleCount</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
        <span class="na">totalVotes</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
        <span class="na">leadingRace</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
        <span class="na">leadingBloodline</span><span class="p">:</span> <span class="nx">results</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
      <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>The last operation with the <a href="http://docs.mongodb.org/manual/reference/method/db.collection.aggregate/"><code>aggregate()</code></a> method is a bit more tricky. Admittedly, I had to get help with that part. In MongoDB, aggregations operations process data records and return computed results. In our case it computes the total number of casted votes by summing up all <code>wins</code> counts. Because this is a zero-sum game, the number of wins should be exactly the same as the number of losses, so we could have used <code>losses</code> counts here as well.</p>

<hr>

<p>And we are all done here. At the end of the tutorial I will post some ideas for you to extend this project further with additional features.</p>

<h2 id="step-16-character-profile-component">Step 16. Character (Profile) Component</h2>

<p>In this section we are going to build the profile page for a character. It is slightly different from other components primarily because of the following:</p>

<ol>
<li>It has a full page image background.</li>
<li>Navigating from one profile page to another profile page does not unmount the component, and as a result, the <code>getCharacter</code> action inside <code>componentDidMount</code> is never called more than once, i.e. it updates the URL but it does not fetch new data.</li>
</ol>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>Character.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> with the following contents:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterStore</span> <span class="nx">from</span> <span class="s1">'../stores/CharacterStore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterActions</span> <span class="nx">from</span> <span class="s1">'../actions/CharacterActions'</span>

<span class="kr">class</span> <span class="nx">Character</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">CharacterStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">CharacterStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">CharacterActions</span><span class="p">.</span><span class="nx">getCharacter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">'.magnific-popup'</span><span class="p">).</span><span class="nx">magnificPopup</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'image'</span><span class="p">,</span>
      <span class="na">mainClass</span><span class="p">:</span> <span class="s1">'mfp-zoom-in'</span><span class="p">,</span>
      <span class="na">closeOnContentClick</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">midClick</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">zoom</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">duration</span><span class="p">:</span> <span class="mi">300</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">CharacterStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">componentDidUpdate</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Fetch new charachter data when URL path changes</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prevProps</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">CharacterActions</span><span class="p">.</span><span class="nx">getCharacter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'profile-img'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'magnific-popup'</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s1">'https://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_1024.jpg'</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'https://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_256.jpg'</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'profile-info clearfix'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">h2</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h4</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;</span><span class="na">Race</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">race</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">h4</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h4</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;</span><span class="na">Bloodline</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">bloodline</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">h4</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h4</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'lead'</span><span class="o">&gt;</span><span class="na">Gender</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">gender</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">h4</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'btn btn-transparent'</span>
                  <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterActions</span><span class="p">.</span><span class="nx">report</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characterId</span><span class="p">)}</span>
                  <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isReported</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isReported</span> <span class="p">?</span> <span class="s1">'Reported'</span> <span class="p">:</span> <span class="s1">'Report Character'</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'profile-stats clearfix'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'stats-number'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">winLossRatio</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span&gt;Winning Percentage&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'stats-number'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">wins</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span&gt; Wins&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'stats-number'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">losses</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span&gt; Losses&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Character</span><span class="p">;</span>
</code></pre></div>
<p>On <code>componentDidMount</code> we pass the current <em>Character ID</em> (from URL) to the <code>getCharacter</code> action and initialize the Magnific Popup lightbox plugin.
</p><div class="admonition note">
  <div class="admonition-title">Note</div>
  I haven't had any success with using <code>ref="magnificPopup"</code> to initialize the plugin, that's why I left it as is. This might not be the best way, but it works.
</div><p></p>

<p>Since the <em>Character</em> component has a full-page background image, during <code>componentWillUnmount</code> it is removed from the <code>&lt;body&gt;</code> tag so that users do not see it when navigating back to <em>Home</em> or <em>Add Character</em> components which do not have a background image. But when is this background image added? In the store when a character data is successfully fetched.</p>

<p>One last thing that is worth mentioning again is what's happening in <code>componentDidUpdate</code>. If we are transitioning from one character page to another character page, we are still within the <em>Character</em> component, i.e. it is never unmounted. And if it isn't unmounted, <code>componentDidMount</code> doesn't fetch new character data. So in <code>componentDidUpdate</code> â€” as long as we are in the same <em>Character</em> component and URL paths are different, e.g. transition from <strong>/characters/1807823526</strong> to <strong>/characters/467078888</strong>, it needs to fetch new character data.</p>

<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Create a new file <em>CharacterActions.js</em> inside <strong><i class="fa fa-folder-open"></i>app/actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">CharacterActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'reportSuccess'</span><span class="p">,</span>
      <span class="s1">'reportFail'</span><span class="p">,</span>
      <span class="s1">'getCharacterSuccess'</span><span class="p">,</span>
      <span class="s1">'getCharacterFail'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getCharacter</span><span class="p">(</span><span class="nx">characterId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/characters/'</span> <span class="o">+</span> <span class="nx">characterId</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getCharacterSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getCharacterFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">report</span><span class="p">(</span><span class="nx">characterId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/report'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">characterId</span><span class="p">:</span> <span class="nx">characterId</span> <span class="p">}</span>
    <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">reportSuccess</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">reportFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">CharacterActions</span><span class="p">);</span>
</code></pre></div>
<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Create a new file <em>CharacterStore.js</em> inside <strong><i class="fa fa-folder-open"></i>app/store</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">assign</span><span class="p">,</span> <span class="nx">contains</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'underscore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterActions</span> <span class="nx">from</span> <span class="s1">'../actions/CharacterActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">CharacterStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">CharacterActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'TBD'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">race</span> <span class="o">=</span> <span class="s1">'TBD'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bloodline</span> <span class="o">=</span> <span class="s1">'TBD'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s1">'TBD'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">wins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">losses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">winLossRatio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isReported</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetCharacterSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'profile '</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">race</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
    <span class="kd">let</span> <span class="nx">localData</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'NEF'</span><span class="p">)</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'NEF'</span><span class="p">))</span> <span class="p">:</span> <span class="p">{};</span>
    <span class="kd">let</span> <span class="nx">reports</span> <span class="o">=</span> <span class="nx">localData</span><span class="p">.</span><span class="nx">reports</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isReported</span> <span class="o">=</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">reports</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">characterId</span><span class="p">);</span>
    <span class="c1">// If is NaN (from division by zero) then set it to "0"</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">winLossRatio</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">wins</span> <span class="o">/</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wins</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">losses</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onGetCharacterFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onReportSuccess</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isReported</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">localData</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'NEF'</span><span class="p">)</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'NEF'</span><span class="p">))</span> <span class="p">:</span> <span class="p">{};</span>
    <span class="nx">localData</span><span class="p">.</span><span class="nx">reports</span> <span class="o">=</span> <span class="nx">localData</span><span class="p">.</span><span class="nx">reports</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">localData</span><span class="p">.</span><span class="nx">reports</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">characterId</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'NEF'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">localData</span><span class="p">));</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">warning</span><span class="p">(</span><span class="s1">'Character has been reported.'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onReportFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">CharacterStore</span><span class="p">);</span>
</code></pre></div>
<p>Here we are using two Underscore's helper functions <a href="http://underscorejs.org/#extendOwn"><code>assign</code></a> and <a href="http://underscorejs.org/#contains"><code>contains</code></a> to merge two objects and check if array contains a certain value, respectively.</p>

<div class="admonition note">
  <div class="admonition-title">Note</div>
  At the time of writing Babel.js does not support <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign"><code>Object.assign</code></a> method and I find <code>contains</code> to be more readable than <code>Array.indexOf() &gt; -1</code> for checking if an array contains some value.
</div>

<p>As I have explained before, this component looks significantly different from all other components. Adding <code>profile</code> CSS class to <code>&lt;body&gt;</code> pretty much changes the entire look and feel due to how some CSS styles are composed in <em>main.less</em>. While the second CSS class, which could be either <code>caldari</code>, <code>gallente</code>, <code>minmatar</code>, <code>amarr</code> (case-sensitive) determine which background image to use. I would generally avoid messing with the DOM that is not part of the <code>render()</code> of that component, but this is a one-off exception. And finally, inside the <code>onGetCharacterSuccess</code> handler we need to check if a character has already been reported by the same user. If they have, the report button will be grayed out and disabled. <em>Since it is fairly easy to get around this restriction, it's probably a good idea to do an IP check on the server if you do not wish to allow your users to report a character more than once.</em></p>

<p>If a character is being reported for the first time, it is saved to Local Storage under the <em>NEF</em> namespace. Since you cannot store objects and arrays in Local Storage, we have to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"><code>JSON.stringify()</code></a> it first.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-19 01.14.26.png" alt=""></p>

<p>Again, open <em>routes.js</em> and a new route for <code>/characters/:id</code>. This route uses a dynamic segment <code>id</code> that will match any valid <em>Character ID</em>. Also, don't forget to import the <em>Character</em> component.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">'./components/Home'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacter</span> <span class="nx">from</span> <span class="s1">'./components/AddCharacter'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Character</span> <span class="nx">from</span> <span class="s1">'./components/Character'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Home</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/add'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacter</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/characters/:id'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Character</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div>
<p>Refresh the browser, click on one of the characters and you should see the new profile page.</p>

<p><img src="./tutorial_files/Screenshot 2015-07-19 01.32.44.png" alt=""></p>

<p>Up next is the <em>CharacterList</em> component for <em>Top 100</em> characters - filtered by gender, race, bloodline and overall. The <em>Hall of Shame</em> is also part of this component.</p>

<h2 id="step-17-top-100-component">Step 17. Top 100 Component</h2>

<p>This component uses Bootstrap's <a href="http://getbootstrap.com/components/#media">Media Object</a> as its main interface. Here is what it looks like:</p>

<p><img src="./tutorial_files/Screenshot 2015-07-19 14.01.37.png" alt=""></p>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>CharacterList.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> with the following contents:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Link</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">isEqual</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'underscore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterListStore</span> <span class="nx">from</span> <span class="s1">'../stores/CharacterListStore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterListActions</span> <span class="nx">from</span> <span class="s1">'../actions/CharacterListActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">CharacterList</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">CharacterListStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">CharacterListStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">CharacterListActions</span><span class="p">.</span><span class="nx">getCharacters</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">CharacterListStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidUpdate</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">.</span><span class="nx">params</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">CharacterListActions</span><span class="p">.</span><span class="nx">getCharacters</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">charactersList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">characters</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">character</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-group-item animated fadeIn'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'media'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'position pull-left'</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'pull-left thumb-lg'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'media-object'</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">'http://image.eveonline.com/Character/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span> <span class="o">+</span> <span class="s1">'_128.jpg'</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'media-body'</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">h4</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'media-heading'</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="s1">'/characters/'</span> <span class="o">+</span> <span class="nx">character</span><span class="p">.</span><span class="nx">characterId</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/Link</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">small</span><span class="o">&gt;</span><span class="na">Race</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">race</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">small</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
              <span class="o">&lt;</span><span class="nx">small</span><span class="o">&gt;</span><span class="na">Bloodline</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">bloodline</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">small</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
              <span class="o">&lt;</span><span class="nx">small</span><span class="o">&gt;</span><span class="na">Wins</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">character</span><span class="p">.</span><span class="nx">wins</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt; Losses: &lt;strong&gt;{character.losses}&lt;/</span><span class="nx">strong</span><span class="o">&gt;&lt;</span><span class="sr">/small</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'list-group'</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">charactersList</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">CharacterList</span><span class="p">;</span>
</code></pre></div>
<p>Since our array of characters is already sorted by the winning percentage, we can use <code>index + 1</code> (1 through 100) to display the position number. It's a position only within that list, not globally across all characters.</p>

<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Create a new file <em>CharacterListActions.js</em> inside <strong><i class="fa fa-folder-open"></i>app/actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">CharacterListActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'getCharactersSuccess'</span><span class="p">,</span>
      <span class="s1">'getCharactersFail'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getCharacters</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'/api/characters/top'</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">race</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">race</span><span class="p">,</span>
      <span class="na">bloodline</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">bloodline</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">category</span> <span class="o">===</span> <span class="s1">'female'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s1">'female'</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">category</span> <span class="o">===</span> <span class="s1">'male'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s1">'male'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">category</span> <span class="o">===</span> <span class="s1">'shame'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">url</span> <span class="o">=</span> <span class="s1">'/api/characters/shame'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="nx">params</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getCharactersSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getCharactersFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">CharacterListActions</span><span class="p">);</span>
</code></pre></div>
<p>The <code>payload</code>, in this case, contains React Router params that we will specify in <em>routes.js</em> shortly:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Route</span> <span class="na">path=</span><span class="s">':category'</span> <span class="na">component=</span><span class="s">{CharacterList}</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Route</span> <span class="na">path=</span><span class="s">':race'</span> <span class="na">component=</span><span class="s">{CharacterList}</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Route</span> <span class="na">path=</span><span class="s">':bloodline'</span> <span class="na">component=</span><span class="s">{CharacterList}</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/Route&gt;</span>
<span class="nt">&lt;/Route&gt;</span>
</code></pre></div>
<p>For example, if we go to <a href="http://localhost:3000/female/gallente/intaki">http://localhost:3000/female/gallente/intaki</a>, then the <code>payload</code> object would contain the following data:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">category</span><span class="p">:</span> <span class="s1">'female'</span><span class="p">,</span>
  <span class="nx">race</span><span class="err">:</span> <span class="s1">'gallente'</span><span class="p">,</span>
  <span class="nx">bloodline</span><span class="err">:</span> <span class="s1">'intaki'</span>
<span class="p">}</span>
</code></pre></div>
<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Create a new file <em>CharacterListStore.js</em> inside <strong><i class="fa fa-folder-open"></i>app/store</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterListActions</span> <span class="nx">from</span> <span class="s1">'../actions/CharacterListActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">CharacterListStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">CharacterListActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characters</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>

  <span class="nx">onGetCharactersSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">characters</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetCharactersFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">CharacterListStore</span><span class="p">);</span>
</code></pre></div>
<p>Open <em>routes.js</em> and the following routes. All three nested routes use dynamic segments so we don't have to repeat ourselves multiple times. Make sure they are the last routes in the file, otherwise <code>:category</code> can override <code>/stats</code>, <code>/add</code> and <code>/shame</code> routes, because it will treat those routes as "categories" instead of being separate routes. Don't forget to import the <em>CharacterList</em> component.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">'./components/Home'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacter</span> <span class="nx">from</span> <span class="s1">'./components/AddCharacter'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Character</span> <span class="nx">from</span> <span class="s1">'./components/Character'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterList</span> <span class="nx">from</span> <span class="s1">'./components/CharacterList'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Home</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/add'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacter</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/characters/:id'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Character</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">':category'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">':race'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">':bloodline'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div>
<p><strong>September 22, 2015 Update:</strong> Fixed a bug with Hall of Shame not fetching the right characters
by removing the <code>/shame</code> route, since it is already passed as <code>category</code> to a dynamic route below it.</p>

<p>Here are all the valid values for dynamic segments above:</p>

<ul>
<li><strong><code>:category</code></strong> â€” <em>male, female, top</em>.</li>
<li><strong><code>:race</code></strong> â€” <em>caldari, gallente, minmatar, amarr</em>.</li>
<li><strong><code>:bloodline</code></strong> â€” <em>civire, deteis, achura, intaki, gallente, jin-mei, amarr, ni-kunni, khanid, brutor, sebiestor, vherokior</em>.</li>
</ul>

<p>As you can see, <em>routes.js</em> could have been much longer if we hard-coded all those routes instead of using dynamic segments.</p>

<h2 id="step-18-stats-component">Step 18. Stats Component</h2>

<p>Our last component is really simple, it's just a table with general statistics such as the total number of characters by race, by gender, overall, total votes cast, leading race, leading bloodline, etc. I won't even need to explain any code because it is that simple.</p>

<p><strong><i class="devicons devicons-react"></i> Component</strong></p>

<p>Create a new file <em>Stats.js</em> inside <strong><i class="fa fa-folder-open"></i>app/components</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">StatsStore</span> <span class="nx">from</span> <span class="s1">'../stores/StatsStore'</span>
<span class="kr">import</span> <span class="nx">StatsActions</span> <span class="nx">from</span> <span class="s1">'../actions/StatsActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Stats</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">StatsStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">StatsStore</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
    <span class="nx">StatsActions</span><span class="p">.</span><span class="nx">getStats</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">StatsStore</span><span class="p">.</span><span class="nx">unlisten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onChange</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onChange</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'container'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'panel panel-default'</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">table</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'table table-striped'</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">th</span> <span class="nx">colSpan</span><span class="o">=</span><span class="s1">'2'</span><span class="o">&gt;</span><span class="nx">Stats</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/thead</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Leading</span> <span class="nx">race</span> <span class="k">in</span> <span class="nx">Top</span> <span class="mi">100</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">leadingRace</span><span class="p">.</span><span class="nx">race</span><span class="p">}</span> <span class="kd">with</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">leadingRace</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span> <span class="nx">characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Leading</span> <span class="nx">bloodline</span> <span class="k">in</span> <span class="nx">Top</span> <span class="mi">100</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">leadingBloodline</span><span class="p">.</span><span class="nx">bloodline</span><span class="p">}</span> <span class="kd">with</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">leadingBloodline</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span> <span class="nx">characters</span>
              <span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Amarr</span> <span class="nx">Characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">amarrCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Caldari</span> <span class="nx">Characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">caldariCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Gallente</span> <span class="nx">Characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">gallenteCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Minmatar</span> <span class="nx">Characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">minmatarCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Total</span> <span class="nx">votes</span> <span class="nx">cast</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">totalVotes</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Female</span> <span class="nx">characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">femaleCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Male</span> <span class="nx">characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">maleCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">Total</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">characters</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>              <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">totalCount</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tbody</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/table</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Stats</span><span class="p">;</span>
</code></pre></div>
<p><strong><i class="devicons devicons-react"></i> Actions</strong></p>

<p>Create a new file <em>StatsActions.js</em> inside <strong><i class="fa fa-folder-open"></i>app/actions</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">StatsActions</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">generateActions</span><span class="p">(</span>
      <span class="s1">'getStatsSuccess'</span><span class="p">,</span>
      <span class="s1">'getStatsFail'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getStats</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/api/stats'</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getStatsSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">((</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">getStatsFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createActions</span><span class="p">(</span><span class="nx">StatsActions</span><span class="p">);</span>
</code></pre></div>
<p><strong><i class="devicons devicons-react"></i> Store</strong></p>

<p>Create a new file <em>StatsStore.js</em> inside <strong><i class="fa fa-folder-open"></i>app/store</strong> directory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">assign</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'underscore'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">alt</span> <span class="nx">from</span> <span class="s1">'../alt'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">StatsActions</span> <span class="nx">from</span> <span class="s1">'../actions/StatsActions'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">StatsStore</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindActions</span><span class="p">(</span><span class="nx">StatsActions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">leadingRace</span> <span class="o">=</span> <span class="p">{</span> <span class="na">race</span><span class="p">:</span> <span class="s1">'Unknown'</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">leadingBloodline</span> <span class="o">=</span> <span class="p">{</span> <span class="na">bloodline</span><span class="p">:</span> <span class="s1">'Unknown'</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">amarrCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">caldariCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gallenteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">minmatarCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">totalVotes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">femaleCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">maleCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">totalCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onGetStatsSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onGetStatsFail</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toastr</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">alt</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">StatsStore</span><span class="p">);</span>
</code></pre></div>
<p>Open <em>routes.js</em> and add our new route â€” <code>/stats</code>. Again, we have to place it before the <code>:category</code> route, so that it takes a higher precedence.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-router'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">'./components/Home'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AddCharacter</span> <span class="nx">from</span> <span class="s1">'./components/AddCharacter'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Character</span> <span class="nx">from</span> <span class="s1">'./components/Character'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CharacterList</span> <span class="nx">from</span> <span class="s1">'./components/CharacterList'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Stats</span> <span class="nx">from</span> <span class="s1">'./components/Stats'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Home</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/add'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AddCharacter</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/characters/:id'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Character</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/shame'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">'/stats'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Stats</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">':category'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">':race'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">':bloodline'</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">CharacterList</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Route</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div>
<p>Refresh the browser and you should see the new <em>Stats</em> component:</p>

<p><img src="./tutorial_files/Screenshot 2015-07-19 14.53.00.png" alt=""></p>

<h2 id="step-19-deployment">Step 19. Deployment</h2>

<p>Now that our project is complete we can finally deploy it. There are many hosting providers out there, but if you have followed any of my projects or tutorials then you should know why I like <a href="https://www.heroku.com/">Heroku</a> so much. Although deployment steps should not differ that much with other hosting providers.</p>

<p>Let's start by creating a <em>.gitignore</em> file in the top-level directory of the project. You can create it either by typing <code>touch .gitignore</code> in the Terminal or using your IDE / Text Editor.</p>

<p>Add the following contents to <em>.gitignore</em>, where most of it is directly from the <a href="https://github.com/github/gitignore">gitignore</a> repository on GitHub:</p>
<div class="highlight"><pre><code class="language-" data-lang=""># Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directory
# Commenting this out is preferred by some people, see
# https://www.npmjs.org/doc/misc/npm-faq.html#should-i-check-my-node_modules-folder-into-git-
node_modules
bower_components

# Users Environment Variables
.lock-wscript

# Project
.idea
*.iml
.DS_Store

# Compiled files
public/css/*
public/js/*
</code></pre></div>
<div class="admonition note">
  <div class="admonition-title">Note</div>
  Remember, we are only checking in source code files to Git, not compiled CSS and JavaScript generated by Gulp.
</div>

<p>You will also need to add the following line to <em>package.json</em>, inside the <a href="https://github.com/sahat/newedenfaces-react/blob/master/package.json#L13"><code>"scripts"</code></a> object:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s2">"postinstall"</span><span class="err">:</span> <span class="s2">"bower install &amp;&amp; gulp build"</span>
</code></pre></div>
<p>Since we will not be checking in compiled CSS and JavaScript to the Git repository, or third-party libraries in <strong><i class="fa fa-folder-open"></i>bower_components</strong>, we need this <code>postinstall</code> command so that Heroku could compile the app and download Bower packages after deployment, otherwise it will not have access to <em>main.css</em>, <em>vendor.js</em>, <em>vendor.bundle.js</em> and <em>bundle.js</em> files inside <strong><i class="fa fa-folder-open"></i>public</strong> directory.</p>

<p><strong>November 22, 2015 Update:</strong> By default, Heroku config is set to <em>production</em> and will install dependencies only from the <code>dependencies</code> object. Inside <em>package.json</em>, move all packages from <code>devDependencies</code> to <code>dependencies</code>.</p>

<p>Next, let's initialize a new Git repository inside <strong><i class="fa fa-folder-open"></i>newedenfaces</strong> directory:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>git init
<span class="gp">$ </span>git add .gitignore
<span class="gp">$ </span>git commit -m <span class="s1">'initial commit'</span>
</code></pre></div>
<p>All of our code is now checked in and we are ready to push it to Heroku. However, first we need to create a new app on Heroku. After creating a new app follow the instructions on this page:</p>

<p><img src="./tutorial_files/Screenshot 2015-07-19 15.17.01.png" alt=""></p>

<p>Since we already initialized a new Git repository, all you really need to do is run the following command, where <em>newedenfaces</em> is the name of my app, so for you it will be something else:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>heroku git:remote -a newedenfaces
</code></pre></div>
<p>One last thing, click on the <em>Settings</em> tab, then <em>Reveal Config Vars</em>, then <em>Edit</em> button and add the following environment variable, matching what we have in <em>config.js</em>:</p>

<table><thead>
<tr>
<th>KEY</th>
<th style="text-align: center">VALUE</th>
</tr>
</thead><tbody>
<tr>
<td><code>MONGO_URI</code></td>
<td style="text-align: center"><code>mongodb://admin:1234@ds061757.mongolab.com:61757/newedenfaces-tutorial</code></td>
</tr>
</tbody></table>

<p>I have provided a sandbox database for the purposes of this tutorial, but if you wish to create your own database you can easily do so for free at <a href="https://mongolab.com/">MongoLab</a> or <a href="https://www.compose.io/">Compose</a> or even directly through <a href="https://addons.heroku.com/">Heroku Addons</a>.</p>

<p>Run the following command and we are all done!</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>git push heroku master
</code></pre></div>
<p>You should now be able to see your app live at <em>http://&lt;app_name&gt;.herokuapp.com</em>.</p>

<h2 id="step-20-additional-resources">Step 20. Additional Resources</h2>

<p>Below is a list of resources that I found interesting and/or helpful during my own learning phase of React, Flux and ES6.</p>

<table><thead>
<tr>
<th>Link</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://elemental-ui.com/">Elemental UI</a></td>
<td>Beautiful UI toolkit for React containing buttons, forms, spinners, modals and other components.</td>
</tr>
<tr>
<td><a href="http://www.toptal.com/react/navigating-the-react-ecosystem">Navigating the React Ecosystem</a></td>
<td>Excellent blog post by Tomas Holas exploring ES6, Generators, Babel, React, React Router, Alt, Flux, React Forms, Typeahead and Calendar widgets. In many ways it complements this tutorial. Highly recommend.</td>
</tr>
<tr>
<td><a href="http://jamesknelson.com/es6-the-bits-youll-actually-use/">A Quick Tour Of ES6</a></td>
<td>Supplemental resource for learning more about new ES6 features. Very practical and easy to read blog post.</td>
</tr>
<tr>
<td><a href="http://acss.io/">Atomic CSS</a></td>
<td>A radical new approach for styling your app. It takes time getting used to it, but when you do, its advantages are quite nice. You no longer have to abstract styles with CSS classes, instead you style React components with "atomic" classes inside your components.</td>
</tr>
<tr>
<td><a href="https://github.com/JedWatson/classnames">classnames</a></td>
<td>A JavaScript utility for conditionally joining <code>classNames</code> together. It's a more elegant solution than using ternary operator and string concatenation.</td>
</tr>
<tr>
<td><a href="https://github.com/goatslacker/iso">Iso</a></td>
<td>Helper class for Alt that allows you to pass initial data from server to client.</td>
</tr>
</tbody></table>

<h2 id="in-closing">In Closing</h2>

<p>In my <a href="https://hackhands.com/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/">previous</a> blog post that I published on December 9th, 2014 I said:</p>

<blockquote>
<p>Congratulations on making it this far! It is now the longest blog post I have published to date. Funny, I said the exact same thing in my TV Show Tracker blog post.</p>
</blockquote>

<p>But now, this post is even longer than my previous one. I seriously didn't expect it to be this long, neither was I trying to beat my old record. But I do hope this tutorial has been helpful and informative. If you learned at least something from this post, then all this writing effort wasn't for nothing.</p>

<p>If you liked this project, consider extending it or perhaps build a new app based on New Eden Faces. All this code is available on <a href="http://github.com/sahat/newedenfaces-react">GitHub</a> and it is completely free, so use or modify it however you want. Here are some ideas for you to work on:</p>

<ul>
<li>Admin UI for resetting stats, swapping incorrect gender, deleting characters.</li>
<li>Email subscription for weekly stats similar to <a href="https://www.google.com/search?q=fitbit+weekly+progress+report&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0CAgQ_AUoAmoVChMItIX17r_oxgIVCVyICh2NUQhh&amp;biw=964&amp;bih=656">Fitbit Weekly Progress Report</a>.</li>
<li>Head-to-head matches between two characters.</li>
<li>Smarter matching algorithm, e.g. high winning characters matched with other high winning characters.</li>
<li><a href="http://www.newedenfaces.com/#browse">List of all characters</a> with pagination.</li>
<li>Store character images on Amazon S3 or MongoDB <a href="http://docs.mongodb.org/manual/core/gridfs/">GridFS</a> to avoid hitting EVE Online API each time.</li>
<li>Image processing algorithm to reject <a href="http://image.eveonline.com/Character/1_512.jpg">placeholder avatars</a> when adding a new character.</li>
<li>Automatically reset stats every X number of rounds.</li>
<li>Display voting history on the character profile page.</li>
<li>Archives page to view Top 100 characters from previous rounds.</li>
<li>Convert API to Relay + GraphQL.</li>
</ul>

<p>From all the emails that I have received since publishing the <a href="http://sahatyalkabov.com/create-a-tv-show-tracker-using-angularjs-nodejs-and-mongodb/">TV Show Tracker</a> tutorial, I have learned that this blog attracts readers of all levels - from long-time JavaScript gurus to those who are just starting out with coding, as well as everyone in between.</p>

<p><em>If you are someone who is struggling with JavaScript:</em></p>

<ul>
<li>Trust me, I have been there before. Coming from the C++ and Java background that they teach you in school, I just didn't get all that asynchronous and callbacks bullshit. At one point I got so angry and frustrated that I thought I would never use JavaScript ever again. The trick was to stop pretending like you know JavaScript and instead learn it from the ground up with an open mind.</li>
</ul>

<p><em>If you are someone who is struggling with the new ES6 syntax:</em></p>

<ul>
<li>I used to loathe ES6. It did not look anything like the JavaScript I've grown to love in the past 2-3 years. Although ES6 is mostly just a syntactical sugar, it felt alien to me. Give it some time and you will grow to like it eventually. Whether someone likes it or not, that's the direction JavaScript is heading to.</li>
</ul>

<p><em>If you are someone who is struggling with React:</em></p>

<ul>
<li>I remember using React for the first time and my initial thought was "What is HTML doing in my JavaScript? F that, I'll stick with AngularJS." But I don't think I need to convince you in 2015 why React is such a great library. A year ago - perhaps, but now just look at all the <a href="https://github.com/facebook/react/wiki/Sites-Using-React">sites using React</a>. React does require a new way of thinking for building apps, but once you get past that hurdle building apps in React is really fun and enjoyable. I have read a lot of React and Flux tutorials, but to be honest I did not fully understand it until I built my own project with it. I just want to reinforce that idea again - building a small project is the best way to learn any technology, not passively reading tutorials and books or watching screencasts and training videos.</li>
</ul>

<p><em>If you are someone who is struggling with coding in general:</em></p>

<ul>
<li>You <em>must</em> learn how to persevere and deal with frustration that will no doubt arise along the way. Don't ever give up. If I gave up in 2009 I wouldn't have majored in Computer Science. If I gave up in 2012 I would've dropped out of college and never would have got my college degree. If I gave up on my Hacker School project in 2014 I would have never released <a href="https://github.com/sahat/satellizer">Satellizer</a> which is currently being used all over the world by thousands of developers. There will always be struggle and frustration, especially with how fast this industry is moving. Despite what you might think, I am not an expert, I still struggle just like you almost every day. It is extremely rare that I go to work and know exactly what and how needs to be done - easy breezy. If that was typically the case, then I am not advancing anywhere and probably should look for a new job.</li>
</ul>

<p><em>If you are a college student seeking advice:</em></p>

<ul>
<li>Start building your portfolio right now. Go create a GitHub account and start contributing to open-source projects or build some of your own projects. Do not expect the school to teach you all the skills required from you on the job market. Don't worry too much if you have a low GPA, as long as you can compensate with a solid portfolio and open-source contributions. Companies that place too much emphasis on your GPA and school prestige are probably not the companies you want to work for, unless that's your thing. Be sure to have a goal in life and work hard towards it. Everything that I have achieved to this date is not because I am gifted and talented, or really bright, or very exceptional, or very lucky, no I am none of the above. It is because I wanted those things and I relentlessly worked hard to get it.</li>
</ul>

<p>This is likely my last tutorial until 2016. I would like to switch back to building open-source apps and libraries so I could create more projects like <a href="https://github.com/sahat/hackathon-starter">Hackathon Starter</a> and <a href="https://github.com/sahat/satellizer">Satellizer</a>.</p>

<p>For questions, comments and general feedback send me an <a href="mailto:sahat@me.com">email</a>. Also due to the high volume of emails from my previous tutorials, I am enabling comments for this post so that other readers could potentially answer some of the questions.</p>

    </section>

    <div class="post-footer">
      <section class="share">
        <ul class="rrssb-buttons clearfix rrssb-1">
          <li class="rrssb-email" data-initwidth="25" data-size="68" style="width: 25%;">
            <a href="mailto:sahat@me.com">
            <span class="rrssb-icon">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g><path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path></g></svg>
            </span>
              <span class="rrssb-text">Send Email</span>
            </a>
          </li>
          <li class="rrssb-twitter" data-initwidth="25" data-size="110" style="width: 25%;">
            <a href="https://twitter.com/home?status=Create%20a%20character%20voting%20app%20using%20React,%20Node.js,%20MongoDB%20and%20Socket.IO%20http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/%20via%20@EvNowAndForever" class="popup">
              <span class="rrssb-icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                  <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                      c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                      C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                      C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                      c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                      C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                  </svg>
              </span>
              <span class="rrssb-text">share on twitter</span>
            </a>
          </li>
          <li class="rrssb-facebook" data-initwidth="25" data-size="126" style="width: 25%;">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/" class="popup">
              <span class="rrssb-icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                          c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                          c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                  </svg>
              </span>
              <span class="rrssb-text">share on facebook</span>
            </a>
          </li>
          <li class="rrssb-googleplus" data-initwidth="25" data-size="118" style="width: 25%;">
            <a href="https://plus.google.com/share?url=http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/" class="popup">
              <span class="rrssb-icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <g>
                          <g>
                              <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663
                                  c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027
                                  C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068
                                  c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562
                                  c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41
                                  c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511
                                  c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478
                                  c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492
                                  c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479
                                  c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"></path>
                              <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004
                                  23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89      "></polygon>
                          </g>
                      </g>
                  </svg>
              </span>
              <span class="rrssb-text">share on google+</span>
            </a>
          </li>
        </ul>
      </section>
      
      <br><br>
      <div id="disqus_thread"><iframe id="dsq-app2" name="dsq-app2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./tutorial_files/saved_resource(1).html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 8034px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe><iframe id="indicator-north" name="indicator-north" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 700px !important; border: none !important; overflow: hidden !important; top: 0px !important; min-width: 700px !important; max-width: 700px !important; position: fixed !important; z-index: 2147483646 !important; height: 29px !important; min-height: 29px !important; max-height: 29px !important; display: none !important;"></iframe><iframe id="indicator-south" name="indicator-south" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 700px !important; border: none !important; overflow: hidden !important; bottom: 0px !important; min-width: 700px !important; max-width: 700px !important; position: fixed !important; z-index: 2147483646 !important; height: 29px !important; min-height: 29px !important; max-height: 29px !important; display: none !important;"></iframe></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES * * */
          var disqus_shortname = 'sahat';

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the &lt;a href="https://disqus.com/?ref_noscript" rel="nofollow"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>
      
    </div>
  </article>
</div>
<footer>
  Â© 2016 Sahat Yalkabov.
  Powered by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/">GitHub Pages</a>.
</footer>
<script src="./tutorial_files/jquery.min.js"></script>
<script src="./tutorial_files/readingTime.min.js"></script>
<script src="./tutorial_files/rrssb.min.js"></script>

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17023058-2', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>

<!-- AdBlock -->
<script>
  (function() {
    var tryMessage = function() {
      setTimeout(function() {
        if (!document.getElementById('carbonads')) {
          $('.carbon-container').removeClass('hidden');
        }
      }, 2000);
    };

    if (window.addEventListener) {
      window.addEventListener('load', tryMessage, false);
    } else {
      window.attachEvent('onload', tryMessage);
    }
  })();
</script>

<!-- Reading Time -->
<script>
  $('.post').readingTime({
    remoteTarget: '.post-content',
    readingTimeTarget: '.post-reading-time'
  });

  // Parallax background
  $(window).resize(parallaxBackground);
  $(window).scroll(parallaxBackground);

  var $image = $('.post-image-image');
  function parallaxBackground() {
    var scrollTotal = $(window).scrollTop();

    if (scrollTotal < 0 || scrollTotal > 1500) {
      return;
    }
    var opacity = 1 - Math.max(scrollTotal / 300, 0);
    opacity = opacity > 0.3 ? opacity : 0.3;
    $image.css('opacity', opacity);

    scrollTotal = Math.floor(scrollTotal / 2);
    $('.post .article-image .post-image-image').css({
      transform: 'translate3d(0,' + scrollTotal + 'px,0)'
    });
  }
</script>

<!-- Twitter -->
<script>!function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
  if (!d.getElementById(id)) {
    js = d.createElement(s);
    js.id = id;
    js.src = p + '://platform.twitter.com/widgets.js';
    fjs.parentNode.insertBefore(js, fjs);
  }
}(document, 'script', 'twitter-wjs');</script>

<!-- Facebook -->
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=535088106626462";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


<div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="Facebook Cross Domain Communication Frame" aria-hidden="true" tabindex="-1" id="fb_xdm_frame_http" src="./tutorial_files/xd_arbiter.html" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="Facebook Cross Domain Communication Frame" aria-hidden="true" tabindex="-1" id="fb_xdm_frame_https" src="./tutorial_files/xd_arbiter(1).html" style="border: none;"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;"></iframe></body></html>